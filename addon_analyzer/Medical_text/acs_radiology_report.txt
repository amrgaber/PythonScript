Addon: acs_radiology

Manifest: __manifest__.py
Content:
```python
# -*- coding: utf-8 -*-
#╔══════════════════════════════════════════════════════════════════════╗
#║                                                                      ║
#║                  ╔═══╦╗       ╔╗  ╔╗     ╔═══╦═══╗                   ║
#║                  ║╔═╗║║       ║║ ╔╝╚╗    ║╔═╗║╔═╗║                   ║
#║                  ║║ ║║║╔╗╔╦╦══╣╚═╬╗╔╬╗ ╔╗║║ ╚╣╚══╗                   ║
#║                  ║╚═╝║║║╚╝╠╣╔╗║╔╗║║║║║ ║║║║ ╔╬══╗║                   ║
#║                  ║╔═╗║╚╣║║║║╚╝║║║║║╚╣╚═╝║║╚═╝║╚═╝║                   ║
#║                  ╚╝ ╚╩═╩╩╩╩╩═╗╠╝╚╝╚═╩═╗╔╝╚═══╩═══╝                   ║
#║                            ╔═╝║     ╔═╝║                             ║
#║                            ╚══╝     ╚══╝                             ║
#║                  SOFTWARE DEVELOPED AND SUPPORTED BY                 ║
#║                ALMIGHTY CONSULTING SOLUTIONS PVT. LTD.               ║
#║                      COPYRIGHT (C) 2016 - TODAY                      ║
#║                      https://www.almightycs.com                      ║
#║                                                                      ║
#╚══════════════════════════════════════════════════════════════════════╝
{ 
    'name': 'Radiology Management',
    'summary': 'Manage Radiology requests, Radiology tests, Invoicing and related history for hospital.',
    'description': """
        This module add functionality to manage Radiology flow. radiology management system
        Hospital Management lab tests radiology invoices radiology test results ACS HMS
    """,
    'version': '1.0.3',
    'category': 'Medical',
    'author': 'Almighty Consulting Solutions Pvt. Ltd.',
    'support': 'info@almightycs.com',
    'website': 'https://www.almightycs.com',
    'license': 'OPL-1',
    'depends': ['acs_hms_base', 'acs_hms_documents_preview'],
    'data': [
        'security/security.xml',
        'security/ir.model.access.csv',

        'report/radiology_prescription.xml',
        'report/radiology_report.xml',
        'report/radiology_request_results.xml',

        'data/mail_template.xml',
        'data/data.xml',
        'data/digest_data.xml',

        'views/radiology_request_view.xml',
        'views/radiology_test_view.xml',
        'views/radiology_patient_test_view.xml',
        'views/hms_base_view.xml',
        'views/res_config.xml',
        'views/portal_template.xml',
        'views/templates_view.xml',
        'views/radiology_view.xml',
        'views/digest_view.xml',

        'views/menu_item.xml',
    ],
    'demo': [
        'data/radiology_demo.xml',
    ],
    'images': [
        'static/description/hms_radiology_almightycs_cover.jpg',
    ],
    'installable': True,
    'application': True,
    'sequence': 1,
    'price': 61,
    'currency': 'USD',
}
# vim:expandtab:smartindent:tabstop=4:softtabstop=4:shiftwidth=4:
```

__init__.py:
Content:
```python
# -*- coding: utf-8 -*-

from . import controllers
from . import models

# vim:expandtab:smartindent:tabstop=4:softtabstop=4:shiftwidth=4:
```

Models:
  File: models/__init__.py
  Content:
```
# -*- coding: utf-8 -*-

from . import hms_base
from . import radiology_base
from . import radiology_request
from . import radiology_test
from . import res_config
from . import digest

# vim:expandtab:smartindent:tabstop=4:softtabstop=4:shiftwidth=4:

```

  File: models/digest.py
  Content:
```
# -*- coding: utf-8 -*-

from odoo import fields, models, _
from odoo.exceptions import AccessError


class Digest(models.Model):
    _inherit = 'digest.digest'

    kpi_acs_radiology_test_total = fields.Boolean('New Radiology Tests')
    kpi_acs_radiology_test_total_value = fields.Integer(compute='_compute_kpi_acs_radiology_test_total_value')

    def _compute_kpi_acs_radiology_test_total_value(self):
        if not self.env.user.has_group('acs_hms_base.group_hms_user'):
            raise AccessError(_("Do not have access, skip this data for user's digest email"))
        for record in self:
            start, end, company = record._get_kpi_compute_parameters()
            labtest = self.env['patient.radiology.test'].search_count([('company_id', '=', company.id), ('date_analysis', '>=', start), ('date_analysis', '<', end), ('state', 'not in', ['cancel'])])
            record.kpi_acs_radiology_test_total_value = labtest

    def _compute_kpis_actions(self, company, user):
        res = super(Digest, self)._compute_kpis_actions(company, user)
        res['kpi_acs_radiology_test_total'] = 'acs_radiology.action_radiology_result&menu_id=%s' % self.env.ref('acs_radiology.menu_radiology_test_result').id
        return res
```

  File: models/hms_base.py
  Content:
```
# -*- coding: utf-8 -*-

from odoo import api, fields, models, _
import uuid


class AccountInvoice(models.Model):
    _inherit = 'account.move'

    radiology_request_id = fields.Many2one('acs.radiology.request', string='Radiology Request', copy=False, ondelete='restrict')
    hospital_invoice_type = fields.Selection(selection_add=[('radiology', 'Radiology')])


class StockMove(models.Model):
    _inherit = "stock.move"

    radiology_test_id = fields.Many2one('patient.radiology.test', string="Radiology Test", ondelete="restrict")


class ACSConsumableLine(models.Model):
    _inherit = "hms.consumable.line"

    patient_radiology_test_id = fields.Many2one('patient.radiology.test', string="Patient Radiology Test", ondelete="restrict")
    radiology_test_id = fields.Many2one('acs.radiology.test', string="Radiology Test", ondelete="restrict")


class ACSPatient(models.Model):
    _inherit = "hms.patient"

    def _rec_count(self):
        rec = super(ACSPatient, self)._rec_count()
        for rec in self:
            rec.radiology_request_count = len(rec.radiology_request_ids)
            rec.radiology_test_count = len(rec.radiology_test_ids)

    def _acs_get_attachemnts(self):
        attachments = super(ACSPatient, self)._acs_get_attachemnts()
        attachments += self.radiology_test_ids.mapped('attachment_ids')
        return attachments

    radiology_request_ids = fields.One2many('acs.radiology.request', 'patient_id', string='Radiology Requests')
    radiology_test_ids = fields.One2many('patient.radiology.test', 'patient_id', string='Radiology Tests')
    radiology_request_count = fields.Integer(compute='_rec_count', string='# Radiology Requests')
    radiology_test_count = fields.Integer(compute='_rec_count', string='# Radiology Tests')

    def action_radiology_requests(self):
        action = self.env["ir.actions.actions"]._for_xml_id("acs_radiology.hms_action_radiology_request")
        action['domain'] = [('id','in',self.radiology_request_ids.ids)]
        action['context'] = {'default_patient_id': self.id}
        return action

    def action_view_test_results(self):
        action = self.env["ir.actions.actions"]._for_xml_id("acs_radiology.action_radiology_result")
        action['domain'] = [('id','in',self.radiology_test_ids.ids)]
        action['context'] = {'default_patient_id': self.id}
        return action


class product_template(models.Model):
    _inherit = "product.template"

    hospital_product_type = fields.Selection(selection_add=[('radiology', 'Radiology')])


class Physician(models.Model):
    _inherit = "hms.physician"

    def _acs_rec_radiology_count(self):
        Labrequest = self.env['acs.radiology.request']
        Labresult = self.env['patient.radiology.test']
        for record in self.with_context(active_test=False):
            record.radiology_request_count = Labrequest.search_count([('physician_id', '=', record.id)])
            record.radiology_result_count = Labresult.search_count([('physician_id', '=', record.id)])

    radiology_request_count = fields.Integer(compute='_acs_rec_radiology_count', string='# Radiology Request')
    radiology_result_count = fields.Integer(compute='_acs_rec_radiology_count', string='# Radiology Result')

    def action_radiology_request(self):
        action = self.env["ir.actions.actions"]._for_xml_id("acs_radiology.hms_action_radiology_request")
        action['domain'] = [('physician_id','=',self.id)]
        action['context'] = {'default_physician_id': self.id}
        return action

    def action_radiology_result(self):
        action = self.env["ir.actions.actions"]._for_xml_id("acs_radiology.action_radiology_result")
        action['domain'] = [('physician_id','=',self.id)]
        action['context'] = {'default_physician_id': self.id}
        return action


class IrAttachment(models.Model):
    _inherit = "ir.attachment"

    def _acs_portal_ensure_token(self):
        """ Get the current record access token """
        if not self.access_token:
            # we use a `write` to force the cache clearing otherwise `return self.access_token` will return False
            self.sudo().write({'access_token': str(uuid.uuid4())})
        return self.access_token

# vim:expandtab:smartindent:tabstop=4:softtabstop=4:shiftwidth=4:
```

  File: models/radiology_base.py
  Content:
```
# -*- coding: utf-8 -*-

from odoo import api, fields, models, _
from odoo.exceptions import UserError


class ACSLabTestUom(models.Model):
    _name = "acs.radiology.test.uom"
    _description = "Radiology Test UOM"
    _order = 'sequence asc'
    _rec_name = 'code'

    name = fields.Char(string='UOM Name', required=True)
    code = fields.Char(string='Code', required=True, index=True, help="Short name - code for the test UOM")
    sequence = fields.Integer("Sequence", default="100")

    _sql_constraints = [('code_uniq', 'unique (name)', 'The Radiology Test code must be unique')]


class AcsRadiology(models.Model):
    _name = 'acs.radiology'
    _description = 'Radiology'
    _inherit = ['mail.thread', 'mail.activity.mixin', 'acs.hms.mixin']
    _inherits = {
        'res.partner': 'partner_id',
    }

    description = fields.Text()
    is_collection_center = fields.Boolean('Is Collection Center')
    partner_id = fields.Many2one('res.partner', 'Partner', ondelete='restrict', required=True)
    active = fields.Boolean(string="Active", default=True)


class LabTest(models.Model):
    _name = "acs.radiology.test"
    _description = "Radiology Test Type"
    _rec_names_search = ['name', 'code']

    name = fields.Char(string='Name', help="Test type, eg X-Ray, hemogram,biopsy...", index=True)
    code = fields.Char(string='Code', help="Short name - code for the test")
    description = fields.Text(string='Description')
    active = fields.Boolean(string="Active", default=True)
    product_id = fields.Many2one('product.product',string='Service', required=True)
    list_price = fields.Float(related='product_id.list_price', string="Price", readonly=True)
    remark = fields.Char(string='Remark')
    report = fields.Text (string='Test Report')
    company_id = fields.Many2one('res.company', ondelete='restrict', 
        string='Company' , default=lambda self: self.env.company)
    consumable_line_ids = fields.One2many('hms.consumable.line', 'radiology_test_id',
        string='Consumable Line')
    acs_tat = fields.Char(string='Turnaround Time')
    subsequent_test_ids = fields.Many2many("acs.radiology.test", "acs_radiology_test_rel", "test_id", "sub_test_id", "Subsequent Tests")

    _sql_constraints = [
        ('code_company_uniq', 'unique (code,company_id)', 'The code of the account must be unique per company !')
    ]

    def _compute_display_name(self):
        for rec in self:
            name = rec.name or ''
            if rec.code:
                name = "%s [%s]" % (rec.name, rec.code)
            rec.display_name = name

    def copy(self, default=None):
        self.ensure_one()
        new_name = _('%s (copy)') % self.name
        new_code = _('%s (copy)') % self.code
        default = dict(default or {}, name=new_name, code=new_code)
        return super(LabTest, self).copy(default)


class RadiologyGroupLine(models.Model):
    _name = "radiology.group.line"
    _description = "Radiology Group Line"

    group_id = fields.Many2one('radiology.group', ondelete='restrict', string='Radiology Group')
    test_id = fields.Many2one('acs.radiology.test',string='Test', ondelete='cascade', required=True)
    acs_tat = fields.Char(related='test_id.acs_tat', string='Turnaround Time', readonly=True)
    instruction = fields.Char(string='Special Instructions')
    sale_price = fields.Float(string='Sale Price')

    @api.onchange('test_id')
    def onchange_test(self):
        if self.test_id:
            self.sale_price = self.test_id.product_id.lst_price


class RadiologyGroup(models.Model):
    _name = "radiology.group"
    _description = "Radiology Group"

    name = fields.Char(string='Group Name', required=True)
    line_ids = fields.One2many('radiology.group.line', 'group_id', string='Medicament line')

# vim:expandtab:smartindent:tabstop=4:softtabstop=4:shiftwidth=4:
```

  File: models/radiology_request.py
  Content:
```
# -*- coding: utf-8 -*-

from odoo import api, fields, models, _
from odoo.exceptions import UserError
from odoo.tools import DEFAULT_SERVER_DATETIME_FORMAT
from datetime import date, datetime, timedelta
from dateutil.relativedelta import relativedelta


class PatientLabTestLine(models.Model):
    _name = "radiology.request.line"
    _description = "Test Lines"

    @api.depends('quantity', 'sale_price')
    def _compute_amount(self):
        for line in self:
            line.amount_total = line.quantity * line.sale_price

    @api.depends('test_id')
    def _acs_is_manager(self):
        is_manager = self.env.user.has_group('acs_radiology.group_hms_radiology_manager')
        for rec in self:
            rec.is_manager = is_manager

    test_id = fields.Many2one('acs.radiology.test',string='Test', ondelete='cascade', required=True)
    acs_tat = fields.Char(related='test_id.acs_tat', string='Turnaround Time', readonly=True)
    instruction = fields.Char(string='Special Instructions')
    radiology_request_id = fields.Many2one('acs.radiology.request',string='Lines', ondelete='cascade')
    sale_price = fields.Float(string='Sale Price')
    company_id = fields.Many2one('res.company', ondelete='restrict', 
        string='Company',related='radiology_request_id.company_id') 
    quantity = fields.Integer(string='Quantity', default=1)
    amount_total = fields.Float(compute="_compute_amount", string="Sub Total", store=True)
    parent_line_id = fields.Many2one('radiology.request.line',string='Parent Line', ondelete='cascade', copy=False)
    patient_radiology_ids = fields.Many2many('patient.radiology.test', 'radiology_request_line_test_rel', 'req_line_id', 'patient_radiology_test_id', 'Radiology Tests', ondelete='cascade')
    is_manager = fields.Boolean(compute=_acs_is_manager)

    @api.onchange('test_id')
    def onchange_test(self):
        if self.test_id:
            price = 0.0
            if self.radiology_request_id.pricelist_id:
                price = self.radiology_request_id.pricelist_id._get_product_price(self.test_id.product_id, 1)
            elif self.radiology_request_id.patient_id.property_product_pricelist:
                price = self.radiology_request_id.patient_id.property_product_pricelist._get_product_price(self.test_id.product_id, 1)
            else:
                price = self.test_id.product_id.lst_price
            self.sale_price = price

    @api.model_create_multi
    def create(self, vals_list):
        res = super().create(vals_list)
        if not self._context.get('avoid_subsequent_test'):
            for record in res:
                for sub_seq_test in record.test_id.subsequent_test_ids:
                    sub_line = self.with_context(avoid_subsequent_test=True).create({
                        'parent_line_id': record.id,
                        'test_id': sub_seq_test.id,
                        'radiology_request_id': record.radiology_request_id.id,
                    })
                    sub_line.onchange_test()
        return res


class RadiologyRequest(models.Model):
    _name = 'acs.radiology.request'
    _description = 'Radiology Request'
    _inherit = ['mail.thread', 'mail.activity.mixin', 'acs.hms.mixin']
    _order = 'date desc, id desc'

    @api.depends('line_ids','line_ids.amount_total')
    def _get_total_price(self):
        for rec in self:
            rec.total_price = sum(line.amount_total for line in rec.line_ids)

    @api.depends('patient_id', 'patient_id.birthday', 'date')
    def get_patient_age(self):
        for rec in self:
            age = ''
            if rec.patient_id.birthday:
                end_data = rec.date or fields.Datetime.now()
                delta = relativedelta(end_data, rec.patient_id.birthday)
                if delta.years <= 2:
                    age = str(delta.years) + _(" Year") + str(delta.months) + _(" Month ") + str(delta.days) + _(" Days")
                else:
                    age = str(delta.years) + _(" Year")
            rec.patient_age = age

    def _acs_rec_count(self):
        for rec in self:
            rec.invoice_count = len(self.invoice_ids)


    name = fields.Char(string='Request Number', readonly=True, index=True, copy=False, tracking=True)
    notes = fields.Text(string='Notes')
    date = fields.Datetime('Date', required=True, default=fields.Datetime.now, tracking=True)
    state = fields.Selection([
        ('draft','Draft'),
        ('requested','Requested'),
        ('accepted','Accepted'),
        ('in_progress','In Progress'),
        ('to_invoice','To Invoice'),
        ('done','Done'),
        ('cancel','Cancel'),],
        string='Status',readonly=True, default='draft', tracking=True)
    patient_id = fields.Many2one('hms.patient', string='Patient', required=True, ondelete='restrict', tracking=True)
    patient_age = fields.Char(compute="get_patient_age", string='Age', store=True,
        help="Computed patient age at the moment of the evaluation")
    physician_id = fields.Many2one('hms.physician',
        string='Prescribing Doctor', help="Doctor who Request the lab test.", ondelete='restrict', tracking=True)
    invoice_id = fields.Many2one('account.move',string='Invoice', copy=False)
    radiology_bill_id = fields.Many2one('account.move',string='Vendor Bill', copy=False)
    line_ids = fields.One2many('radiology.request.line', 'radiology_request_id',
        string='Radiology Test Line', copy=True)
    invoice_exempt = fields.Boolean(string='Invoice Exempt', readonly=True)
    total_price = fields.Float(compute=_get_total_price, string='Total', store=True)
    info = fields.Text(string='Extra Info')
    company_id = fields.Many2one('res.company', ondelete='restrict', 
        string='Hospital', default=lambda self: self.env.company)
    pricelist_id = fields.Many2one('product.pricelist', string='Pricelist', check_company=True, 
        domain="['|', ('company_id', '=', False), ('company_id', '=', company_id)]",
        help="If you change the pricelist, related invoice will be affected.")
    payment_state = fields.Selection(related="invoice_id.payment_state", store=True, string="Payment Status")
    radiology_group_id = fields.Many2one('radiology.group', ondelete="set null", string='Test Group')
    acs_radiology_invoice_policy = fields.Selection(related="company_id.acs_radiology_invoice_policy")

    #Just to make object selectable in selction field this is required: Waiting Screen
    acs_show_in_wc = fields.Boolean(default=True)
    is_group_request = fields.Boolean()
    group_patient_ids = fields.Many2many("hms.patient", "hms_patient_radiology_req_rel", "radiology_request_id", "patient_id", string="Other Group Patients")
    patient_test_ids = fields.One2many('patient.radiology.test', 'radiology_request_id', string='Test Results')

    invoice_ids = fields.One2many('account.move', 'radiology_request_id', string='Invoices')
    invoice_count = fields.Integer(compute='_acs_rec_count', string='# Invoices')
    acs_show_create_invoice = fields.Boolean(compute="get_acs_show_create_invoice", string="Show Create Invoice Button")

    #ACS: Compute visiblity of create invocie button.
    def get_acs_show_create_invoice(self):
        for rec in self:
            acs_show_create_invoice = False
            if not rec.invoice_id :
                if rec.state=='to_invoice':
                    acs_show_create_invoice = True
                elif rec.acs_radiology_invoice_policy=='any_time' and not rec.invoice_exempt:
                    acs_show_create_invoice = True
                elif rec.acs_radiology_invoice_policy=='in_advance' and not rec.invoice_exempt:
                    acs_show_create_invoice = True
            rec.acs_show_create_invoice = acs_show_create_invoice

    def _compute_display_name(self):
        for rec in self:
            name = rec.name or '-'
            if rec.patient_id:
                name += ' [' + rec.patient_id.name + ']'
            rec.display_name = name

    @api.onchange('radiology_group_id')
    def onchange_radiology_group(self):
        test_line_ids = []
        if self.radiology_group_id:
            for line in self.radiology_group_id.line_ids:
                test_line_ids.append((0,0,{
                    'test_id': line.test_id.id,
                    'instruction': line.instruction,
                    'sale_price' : line.sale_price,
                }))
            self.line_ids = test_line_ids

    def unlink(self):
        for rec in self:
            if rec.state not in ['draft']:
                raise UserError(_("Radiology Requests can be delete only in Draft state."))
        return super(RadiologyRequest, self).unlink()

    def button_requested(self):
        if not self.line_ids:
            raise UserError(_('Please add atleast one Radiology test line before submiting request.'))
        self.name = self.env['ir.sequence'].next_by_code('acs.radiology.request')
        if self.is_group_request:
            for line in self.line_ids:
                line.quantity = len(self.group_patient_ids) + 1
        self.state = 'requested'

    def button_accept(self):
        company_id = self.sudo().company_id
        if company_id.acs_radiology_invoice_policy=='in_advance':
            if not self.invoice_id:
                raise UserError(_('Invoice is not created yet.'))
            elif self.invoice_id and company_id.acs_check_radiology_payment and self.payment_state not in ['in_payment','paid']:
                raise UserError(_('Invoice is not Paid yet.'))
        self.state = 'accepted'

    def prepare_test_result_data(self, line, patient):
        parent_test_id = False
        if line.parent_line_id and line.parent_line_id.patient_radiology_ids:
            parent_test_ids = line.parent_line_id.patient_radiology_ids.filtered(lambda lt: lt.patient_id==patient)
            if parent_test_ids:
                parent_test_id = parent_test_ids[0].id

        res = {
            'patient_id': patient.id,
            'physician_id': self.physician_id and self.physician_id.id,
            'test_id': line.test_id.id,
            'user_id': self.env.user.id,
            'date_requested': self.date,
            'radiology_request_id': self.id,
            'parent_test_id': parent_test_id,
        }
        return res

    def button_in_progress(self):
        self.state = 'in_progress'
        LabTest = self.env['patient.radiology.test']
        Consumable = self.env['hms.consumable.line']
        gender = self.patient_id.gender

        patients = self.mapped('patient_id') + self.mapped('group_patient_ids')
        for line in self.line_ids:
            for patient in patients:
                radiology_test_data = self.prepare_test_result_data(line, patient)
                test_result = LabTest.create(radiology_test_data)
                line.patient_radiology_ids = [(4, test_result.id)]

                for con_line in line.test_id.consumable_line_ids:
                    Consumable.create({
                        'patient_radiology_test_id': test_result.id,
                        'name': con_line.name,
                        'product_id': con_line.product_id and con_line.product_id.id or False,
                        'product_uom_id': con_line.product_uom_id and con_line.product_uom_id.id or False,
                        'qty': con_line.qty,
                        'date': fields.Date.today(),
                    })

    def button_done(self):
        if not self.invoice_id:
            self.state = 'to_invoice'
        else:
            self.state = 'done'

    def button_cancel(self):
        self.state = 'cancel'

    def button_draft(self):
        self.state = 'draft'

    def get_radiology_invoice_data(self):
        product_data = [{
            'name': _("Radiology Charges"),
        }]
        for rec in self:
            for line in rec.line_ids:
                product_data.append({
                    'product_id': line.test_id.product_id,
                    'price_unit': line.sale_price,
                    'quantity': line.quantity,
                })
        return product_data

    def create_invoice(self):
        if not self.line_ids:
            raise UserError(_("Please add lab Tests first."))

        product_data = self.get_radiology_invoice_data()
        acs_context = {}
        if self.pricelist_id:
            acs_context.update({'acs_pricelist_id': self.pricelist_id.id})
        if self.physician_id:
            acs_context.update({'commission_partner_ids':self.physician_id.partner_id.id})

        invoice = self.with_context(acs_context).acs_create_invoice(partner=self.patient_id.partner_id, patient=self.patient_id, product_data=product_data, inv_data={'hospital_invoice_type': 'radiology','physician_id': self.physician_id and self.physician_id.id or False})
        self.invoice_id = invoice.id
        invoice.radiology_request_id = self.id
        if self.state == 'to_invoice':
            self.state = 'done'

    def view_invoice(self):
        action = self.acs_action_view_invoice(self.invoice_ids)
        return action

    def action_view_test_results(self):
        action = self.env["ir.actions.actions"]._for_xml_id("acs_radiology.action_radiology_result")
        action['domain'] = [('radiology_request_id','=',self.id)]
        action['context'] = {'default_radiology_request_id': self.id, 'default_physician_id': self.physician_id.id}
        return action

    def _acs_get_report_base_filename(self):
        if not self.patient_test_ids:
            raise UserError(_("There are no linked results to print."))
        return (self.name or 'LabResults').replace('/','_') + '_LabResults'

    def acs_update_price(self):
        for line in self.line_ids:
            line.onchange_test()

    #method to create get invoice data and set passed invoice id.
    def acs_common_invoice_radiology_data(self, invoice_id=False):
        data = []
        if self.ids:
            data = self.get_radiology_invoice_data()
            if invoice_id:
                self.invoice_id = invoice_id.id
        return data

# vim:expandtab:smartindent:tabstop=4:softtabstop=4:shiftwidth=4:
```

  File: models/radiology_test.py
  Content:
```
# -*- coding: utf-8 -*-

from odoo import api, fields, models, _
from odoo.exceptions import UserError
import uuid


class PatientLabTest(models.Model):
    _name = "patient.radiology.test"
    _inherit = ['mail.thread', 'mail.activity.mixin', 'acs.hms.mixin', 'portal.mixin', 'acs.document.mixin', 'acs.qrcode.mixin', 'acs.document.view.mixin']
    _description = "Patient Radiology Test"
    _order = 'date_analysis desc, id desc'

    @api.model
    def _get_disclaimer(self):
        return self.env.user.sudo().company_id.acs_radiology_disclaimer or ''


    name = fields.Char(string='Test ID', help="Radiology result ID", readonly=True,copy=False, index=True, tracking=True)
    test_id = fields.Many2one('acs.radiology.test', string='Test', required=True, ondelete='restrict', tracking=True)
    patient_id = fields.Many2one('hms.patient', string='Patient', required=True, ondelete='restrict', tracking=True)
    user_id = fields.Many2one('res.users',string='Radiology User', default=lambda self: self.env.user)
    physician_id = fields.Many2one('hms.physician',string='Prescribing Doctor', help="Doctor who requested the test", ondelete='restrict')
    radiology_physician_id = fields.Many2one('hms.physician',string='Radiology Doctor', help="Doctor who Approved the test", ondelete='restrict')

    diagnosis = fields.Text(string='Diagnosis')
    date_requested = fields.Datetime(string='Request Date')
    date_analysis = fields.Datetime(string='Test Date', default=fields.Datetime.now)
    radiology_request_id = fields.Many2one('acs.radiology.request', string='Test Request', ondelete='restrict')
    report = fields.Text(string='Test Report')
    note = fields.Text(string='Extra Info')
    company_id = fields.Many2one('res.company', ondelete='restrict', 
        string='Company', default=lambda self: self.env.company)
    state = fields.Selection([
        ('draft','Draft'),
        ('done','Done'),
        ('cancel','Cancel'),
    ], string='Status',readonly=True, default='draft', tracking=True)
    consumable_line_ids = fields.One2many('hms.consumable.line', 'patient_radiology_test_id',
        string='Consumable Line')
    disclaimer = fields.Text("Dislaimer", default=_get_disclaimer)
    parent_test_id = fields.Many2one('patient.radiology.test', string='Parent Test', ondelete='cascade', copy=False)
    child_test_ids = fields.One2many('patient.radiology.test', 'parent_test_id', string='Child Tests', copy=False)

    #Just to make object selectable in selction field this is required: Waiting Screen
    acs_show_in_wc = fields.Boolean(default=True)

    _sql_constraints = [
        ('name_company_uniq', 'unique (name,company_id)', 'Test Name must be unique per company !')
    ]

    def _track_subtype(self, init_values):
        self.ensure_one()
        if 'state' in init_values and self.state == 'done':
            return self.env.ref('acs_radiology.mt_radiology_test_done')
        return super(PatientLabTest, self)._track_subtype(init_values)

    def _compute_display_name(self):
        for rec in self:
            name = rec.name or '-'
            if rec.test_id:
                name += ' [' + rec.test_id.name + ']'
            rec.display_name = name

    def _subscribe_physician(self):
        done_subtype = self.env.ref('acs_radiology.mt_radiology_test_done').id
        comment_subtype = self.env.ref('mail.mt_comment').id
        for rec in self:
            if rec.physician_id.partner_id and rec.physician_id.partner_id.id not in rec.message_partner_ids.ids:
                rec.message_subscribe(partner_ids=[rec.physician_id.partner_id.id], subtype_ids=[done_subtype,comment_subtype])

    @api.model_create_multi
    def create(self, vals_list):
        for vals in vals_list:
            vals['name'] = self.env['ir.sequence'].next_by_code('patient.radiology.test')
        res = super().create(vals_list)
        for record in res:
            record.unique_code = uuid.uuid4()
            record._subscribe_physician()
        return res

    def write(self, values):
        if 'physician_id' in values:
            self._subscribe_physician()
        return super(PatientLabTest, self).write(values)

    def unlink(self):
        for rec in self:
            if rec.state not in ['draft']:
                raise UserError(_("Radiology Test can be delete only in Draft state."))
        return super(PatientLabTest, self).unlink()

    @api.onchange('radiology_request_id')
    def onchange_radiology_request_id(self):
        if self.radiology_request_id and self.radiology_request_id.date:
            self.date_requested = self.radiology_request_id.date

    def action_radiology_test_send(self):
        '''
        This function opens a window to compose an email, with the template message loaded by default
        '''
        self.ensure_one()
        template_id = self.env['ir.model.data']._xmlid_to_res_id('acs_radiology.acs_radiology_test_email', raise_if_not_found=False)

        ctx = {
            'default_model': 'patient.radiology.test',
            'default_res_ids': self.ids,
            'default_use_template': bool(template_id),
            'default_template_id': template_id,
            'default_composition_mode': 'comment',
            'force_email': True
        }
        return {
            'type': 'ir.actions.act_window',
            'res_model': 'mail.compose.message',
            'views': [(False, 'form')],
            'view_id': False,
            'target': 'new',
            'context': ctx,
        }

    @api.onchange('test_id')
    def on_change_test(self):
        test_lines = []
        if self.test_id:
            gender = self.patient_id.gender

    def action_done(self):
        if not self.diagnosis:
            raise UserError(_("Please update diagnosis first on result."))
        self.consume_radiology_material()
        self.state = 'done'

    def action_cancel(self):
        self.state = 'cancel'

    def action_draft(self):
        self.state = 'draft'

    def acs_get_consume_locations(self):
        if not self.company_id.acs_radiology_usage_location_id:
            raise UserError(_('Please define a location where the consumables will be used during the Radiology test in company.'))
        if not self.company_id.acs_radiology_stock_location_id:
            raise UserError(_('Please define a Radiology location from where the consumables will be taken.'))

        dest_location_id  = self.company_id.acs_radiology_usage_location_id.id
        source_location_id  = self.company_id.acs_radiology_stock_location_id.id
        return source_location_id, dest_location_id

    def consume_radiology_material(self):
        for rec in self:
            source_location_id, dest_location_id = rec.acs_get_consume_locations()
            for line in rec.consumable_line_ids.filtered(lambda s: not s.move_id):
                if line.product_id.is_kit_product:
                    move_ids = []
                    for kit_line in line.product_id.acs_kit_line_ids:
                        if kit_line.product_id.tracking!='none':
                            raise UserError("In Consumable lines Kit product with component having lot/serial tracking is not allowed. Please remove such kit product from consumable lines.")
                        move = self.consume_material(source_location_id, dest_location_id,
                            {'product': kit_line.product_id, 'qty': kit_line.product_qty * line.qty})
                        move.radiology_test_id = rec.id
                        move_ids.append(move.id)
                    #Set move_id on line also to avoid issue
                    line.move_id = move.id
                    line.move_ids = [(6,0,move_ids)]
                else:
                    move = self.consume_material(source_location_id, dest_location_id,
                        {'product': line.product_id, 'qty': line.qty, 'lot_id': line.lot_id and line.lot_id.id or False,})
                    move.radiology_test_id = rec.id
                    line.move_id = move.id

    def _compute_access_url(self):
        super(PatientLabTest, self)._compute_access_url()
        for rec in self:
            rec.access_url = '/my/radiology_results/%s' % (rec.id)

# vim:expandtab:smartindent:tabstop=4:softtabstop=4:shiftwidth=4:
```

  File: models/res_config.py
  Content:
```
# -*- coding: utf-8 -*-
# Part of AlmightyCS See LICENSE file for full copyright and licensing details.

from odoo import api, fields, models, SUPERUSER_ID, _


class ResCompany(models.Model):
    _inherit = "res.company"

    acs_radiology_usage_location_id = fields.Many2one('stock.location', 
        string='Usage Location for Consumed Radiology Test Material.')
    acs_radiology_stock_location_id = fields.Many2one('stock.location', 
        string='Stock Location for Consumed Radiology Test Material')
    acs_radiology_result_qrcode = fields.Boolean(string="Print Authetication QrCode on Radiology Result", default=True)
    acs_radiology_invoice_policy = fields.Selection([('any_time', 'Anytime'), ('in_advance', 'Advance'),
        ('in_end', 'At End')], default="any_time", string="Radiology Invoice Policy", required=True)
    acs_check_radiology_payment = fields.Boolean(string="Check Payment Status before Accepting Radiology Request")
    acs_radiology_disclaimer = fields.Text(string="Radiology Disclaimer")


class ResConfigSettings(models.TransientModel):
    _inherit = 'res.config.settings'

    acs_radiology_usage_location_id = fields.Many2one('stock.location', 
        related='company_id.acs_radiology_usage_location_id',
        domain=[('usage','=','customer')],
        string='Usage Location for Consumed Radiology Test Material', readonly=False)
    acs_radiology_stock_location_id = fields.Many2one('stock.location', 
        related='company_id.acs_radiology_stock_location_id',
        domain=[('usage','=','internal')],
        string='Stock Location for Consumed Radiology Test Material', readonly=False)
    acs_radiology_result_qrcode = fields.Boolean(related='company_id.acs_radiology_result_qrcode', string="Print Authetication QrCode on Radiology Result", readonly=False)
    acs_radiology_invoice_policy = fields.Selection(related='company_id.acs_radiology_invoice_policy', string="Radiology Invoice Policy", readonly=False)
    acs_check_radiology_payment = fields.Boolean(related='company_id.acs_check_radiology_payment', string="Check Payment Status before Accepting Radiology Request", readonly=False)
    acs_radiology_disclaimer = fields.Text(related='company_id.acs_radiology_disclaimer', string="Radiology Disclaimer", readonly=False)

# vim:expandtab:smartindent:tabstop=4:softtabstop=4:shiftwidth=4:
```

Views:
  File: views/digest_view.xml
  Content:
```
<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="digest_digest_view_form" model="ir.ui.view">
        <field name="name">digest.digest.view.form</field>
        <field name="model">digest.digest</field>
        <field name="inherit_id" ref="digest.digest_digest_view_form" />
        <field name="arch" type="xml">
            <xpath expr="//group[@name='kpi_general']" position="inside">
                <field name="kpi_acs_radiology_test_total"/>
            </xpath>
        </field>
    </record>

</odoo>
```

  File: views/hms_base_view.xml
  Content:
```
<?xml version="1.0"?>
<odoo>

    <!-- Patient -->
    <record id="hms_patient_view_radiology_test" model="ir.ui.view">
        <field name="name">Patient Radiology Test</field>
        <field name="model">hms.patient</field>
        <field name="inherit_id" ref="acs_hms_base.view_patient_form"/>
        <field name="arch" type="xml">
            <div name="button_box" position="inside">
                <button name="action_radiology_requests" class="oe_stat_button" icon="fa-th-list" type="object" title="Radiology Requests" groups="acs_radiology.group_hms_radiology_user">
                    <field string="Radiology Requests" name="radiology_request_count" widget="statinfo"/>
                </button>
                <button name="action_view_test_results" class="oe_stat_button" icon="fa-flask" type="object" title="Radiology Test Results" groups="acs_radiology.group_hms_radiology_user">
                    <field string="Radiology Test Results" name="radiology_test_count" widget="statinfo"/>
                </button>
            </div>
        </field>
    </record>

    <record id="view_physician_form" model="ir.ui.view">
        <field name="name">physician.form</field>
        <field name="model">hms.physician</field>
        <field name="inherit_id" ref="acs_hms_base.view_physician_form"/>
        <field name="arch" type="xml">
            <div name="button_box" position="inside">
                <button name="action_radiology_request" type="object" groups="acs_radiology.group_hms_radiology_user" class="oe_stat_button" icon="fa-th-list">
                    <field string="Radiology Request" name="radiology_request_count" widget="statinfo"/>
                </button>

                <button name="action_radiology_result" type="object" groups="acs_radiology.group_hms_radiology_user" class="oe_stat_button" icon="fa-flask">
                    <field string="Radiology Result" name="radiology_result_count" widget="statinfo"/>
                </button>
            </div>
        </field>
    </record>

    <record id="view_move_form" model="ir.ui.view">
        <field name="name">account.move.form</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="acs_hms_base.view_move_form"/>
        <field name="arch" type="xml">
            <field name="hospital_invoice_type" position="before">
                <field name="radiology_request_id"/>
            </field>
        </field>
    </record>

</odoo>
```

  File: views/menu_item.xml
  Content:
```
<?xml version="1.0" encoding="UTF-8"?>
<odoo>

    <!-- Radiology Root Menu -->
    <menuitem id="menu_radiology" name="Radiology" sequence="35" web_icon="acs_radiology,static/description/icon.png" groups="acs_radiology.group_hms_radiology_user"/>
    <menuitem id='menu_radiology_request' parent='menu_radiology' action='hms_action_radiology_request' sequence="10"/>
    <menuitem id='menu_radiology_test_result' action='action_radiology_result' parent='menu_radiology' sequence="20"/>

    <!-- Configuration -->
    <menuitem id="menu_hms_radiology_cofig" name="Configuration" parent="menu_radiology" groups="acs_hms_base.group_hms_manager,acs_radiology.group_hms_radiology_manager" sequence="100"/>
    <menuitem id='menu_radiology_test' parent='menu_hms_radiology_cofig' action='action_radiology_test' sequence="10"/>
    <menuitem id='menu_acs_radiology_group' parent='menu_hms_radiology_cofig' action='action_radiology_group' sequence="40"/>

</odoo>
```

  File: views/portal_template.xml
  Content:
```
<odoo>

    <!-- Portal View -->
    <template id="portal_my_home_menu_hms" name="Portal layout : HMS Data" inherit_id="portal.portal_breadcrumbs" priority="20">
        <xpath expr="//ol[hasclass('o_portal_submenu')]" position="inside">
            <li t-if="page_name == 'radiology_result' or radiology_result" t-attf-class="breadcrumb-item #{'active ' if not radiology_results else ''}">
                <a t-if="radiology_result" t-attf-href="/my/radiology_results?{{ keep_query() }}">Radiology Results</a>
                <t t-else="">Radiology Results</t>
            </li>
            <li t-if="radiology_result" class="breadcrumb-item active">
                <t t-esc="radiology_result.name"/>
            </li>

            <li t-if="page_name == 'radiology_request' or radiology_request" t-attf-class="breadcrumb-item #{'active ' if not radiology_requests else ''}">
                <a t-if="radiology_request" t-attf-href="/my/radiology_requests?{{ keep_query() }}">Radiology Request</a>
                <t t-else="">Radiology Requests</t>
            </li>
            <li t-if="radiology_request" class="breadcrumb-item active">
                <t t-esc="radiology_request.name"/>
            </li>
        </xpath>
    </template>

    <template id="portal_my_home" name="Radiology - Portal My Home" inherit_id="portal.portal_my_home" priority="30" customize_show="True">
        <div id="portal_client_category" position="after">
            <div class="o_portal_category row g-2 mt-3" id="portal_acs_radiology_category">
                <t t-call="portal.portal_docs_entry">
                    <t t-set="icon" t-value="'/acs_radiology/static/description/radiology.png'"/>
                    <t t-set="title">Radiology Requests</t>
                    <t t-set="url" t-value="'/my/radiology_requests'"/>
                    <t t-set="text">Review all your radiology requests</t>
                    <t t-set="placeholder_count" t-value="'radiology_request_count'"/>
                </t>
                <t t-call="portal.portal_docs_entry">
                    <t t-set="icon" t-value="'/acs_radiology/static/description/radiology.png'"/>
                    <t t-set="title">Radiology Results</t>
                    <t t-set="url" t-value="'/my/radiology_results'"/>
                    <t t-set="text">Review all your radiology results</t>
                    <t t-set="placeholder_count" t-value="'radiology_result_count'"/>
                </t>
            </div>
        </div>
    </template>

    <template id="radiology_results" name="My Radiology Results">
        <t t-call="portal.portal_layout">

            <t t-set="breadcrumbs_searchbar" t-value="True"/>

            <t t-call="portal.portal_searchbar">
                <t t-set="title">Radiology Results</t>
            </t>
            <t t-if="not radiology_results">
                <p>There are currently no Radiology Results for your account.</p>
            </t>

            <div t-if="radiology_results" class="panel panel-default">
                <div class="table-responsive">
                    <table class="table table-hover bg-white status_table o_portal_my_doc_table">
                        <thead>
                            <tr class="active">
                                <th>Name</th>
                                <th>Radiology Test</th>
                                <th>Request</th>
                                <th>Date Analysis</th>
                                <th>Diagnosis</th>
                            </tr>
                        </thead>

                        <t t-foreach="radiology_results" t-as="result">
                            <tr>
                                <td>
                                    <a t-attf-href="/my/radiology_results/#{result.id}?{{ keep_query() }}"><t t-esc="result.name"/></a>
                                </td>
                                <td>
                                    <span t-field="result.test_id.name"/>
                                </td>
                                <td>
                                    <span t-field="result.sudo().radiology_request_id.name"/>
                                </td>
                                <td>
                                    <span t-field="result.date_analysis"/>
                                </td>
                                <td>
                                    <span t-field="result.diagnosis"/>
                                </td>
                                <td>
                                    <a class="btn btn-primary" target="_blank" title="Radiology Report"
                                        t-att-href="'/report/pdf/acs_radiology.report_acs_radiology_test/'+str(result.id)">Print</a>
                                </td>
                            </tr>
                        </t>
                    </table>
                </div>
            </div>
            <div t-if="pager" class="o_portal_pager text-center">
                <t t-call="portal.pager"/>
            </div>
        </t>
    </template>
 
    <template id="my_radiology_test_result" name="Radiology Result" >
        <t t-call="portal.portal_layout">
            <!-- Page Content -->
            <div id="result_content" class="col-12 col-lg mt32">
                <div t-if="radiology_result.attachment_ids" id="result_communication" class="mt-4">
                    <h2>Related Documents</h2>
                    <div class="table-responsive">
                        <table class="table table-hover bg-white status_table o_portal_my_doc_table">
                            <thead>
                                <tr class="active">
                                    <th>Document</th>
                                    <th>Name</th>
                                    <th class="col-md-8">Description</th>
                                </tr>
                            </thead>

                            <t t-foreach="radiology_result.attachment_ids" t-as="document">
                                <tr>
                                    <td>Document <t t-esc="document.id"/></td>
                                    <td>
                                        <div>
                                            <a t-att-href="'/web/content?model=ir.attachment&amp;field=datas&amp;id=%s&amp;download=true&amp;filename_field=name&amp;access_token=%s' % (document.id, document.access_token)"><span class="fa fa-download"/><span t-field="document.name"/></a>
                                        </div>
                                    </td>
                                    <td><span t-field="document.description"/></td>
                                </tr>
                            </t>
                        </table>
                    </div>
                </div>

                <div class="o_portal_html_view shadow p-3" style="background-color: white;">
                    <t t-call="acs_radiology.report_acs_radiology_test_document" t-lang="radiology_result.patient_id.partner_id.lang">
                        <t t-set="doc" t-value="radiology_result.sudo()"/>
                    </t>
                </div>
                <!-- chatter -->
                <div id="result_communication" class="mt-4">
                    <h2>History</h2>
                    <t t-call="portal.message_thread">
                        <t t-set="object" t-value="radiology_result"/>
                    </t>
                </div>
            </div>
        </t>
    </template>

    <!-- Radiology Request -->
    <template id="radiology_requests" name="My Radiology Request">
        <t t-call="portal.portal_layout">

            <t t-set="breadcrumbs_searchbar" t-value="True"/>

            <t t-call="portal.portal_searchbar">
                <t t-set="title">Radiology Requests</t>
            </t>
            <t t-if="not radiology_requests">
                <p>There are currently no Radiology Requests for your account.</p>
            </t>

            <div t-if="radiology_requests" class="panel panel-default">
                <div class="table-responsive">
                    <table class="table table-hover bg-white status_table o_portal_my_doc_table">
                        <thead>
                            <tr class="active">
                                <th>Name</th>
                                <th>Request Date</th>
                                <th>Total Amount</th>
                                <th name="th_state">Status</th>
                                <th></th>
                            </tr>
                        </thead>

                        <t t-foreach="radiology_requests" t-as="radiology_req">
                            <tr>
                                <td>
                                    <a t-attf-href="/my/radiology_requests/#{radiology_req.id}?{{ keep_query() }}"><t t-esc="radiology_req.name"/></a>
                                </td>
                                <td>
                                    <span t-field="radiology_req.date"/>
                                </td>
                                <td>
                                    <span t-field="radiology_req.total_price"/>
                                </td>
                                <td class="tx_status text-start">
                                    <t t-if="radiology_req.state == 'draft'">
                                        <span class="badge rounded-pill text-bg-info">
                                            <span class="d-none d-md-inline"> Draft</span>
                                        </span>
                                    </t>
                                    <t t-if="radiology_req.state == 'requested'">
                                        <span class="badge rounded-pill text-bg-warning">
                                            <span class="d-none d-md-inline"> Requested</span>
                                        </span>
                                    </t>
                                    <t t-if="radiology_req.state == 'cancel'">
                                        <span class="badge rounded-pill text-bg-danger">
                                            <span class="d-none d-md-inline"> Cancel</span>
                                        </span>
                                    </t>
                                    <t t-if="radiology_req.state == 'done'">
                                        <span class="badge rounded-pill text-bg-success">
                                            <span class="d-none d-md-inline"> Done</span>
                                        </span>
                                    </t>
                                    <t t-if="radiology_req.state == 'in_progress'">
                                        <span class="badge rounded-pill text-bg-primary">
                                            <span class="d-none d-md-inline"> In Progress</span>
                                        </span>
                                    </t>
                                    <t t-if="radiology_req.state == 'to_invoice'">
                                        <span class="badge rounded-pill text-bg-primary">
                                            <span class="d-none d-md-inline"> To Invoice</span>
                                        </span>
                                    </t>
                                    <t t-if="radiology_req.state == 'accepted'">
                                        <span class="badge rounded-pill text-bg-it">
                                            <span class="d-none d-md-inline"> Accepted</span>
                                        </span>
                                    </t>
                                </td>
                                <td>
                                    <a class="btn btn-primary" target="_blank" title="Radiology Report"
                                        t-att-href="'/report/pdf/acs_radiology.report_acs_radiology_prescription/'+str(radiology_req.id)">Print</a>
                                </td>
                            </tr>
                        </t>
                    </table>
                </div>
            </div>
            <div t-if="pager" class="o_portal_pager text-center">
                <t t-call="portal.pager"/>
            </div>
        </t>
    </template>

    <template id="my_radiology_test_request" name="Radiology Request" >
        <t t-call="portal.portal_layout">
            <!-- Page Content -->
            <div id="request_content" class="col-12 col-lg mt32">

                <div class="o_portal_html_view shadow p-3" style="background-color: white;">
                    <t t-call="acs_radiology.report_acs_radiology_prescription_document" t-lang="radiology_request.patient_id.partner_id.lang">
                        <t t-set="doc" t-value="radiology_request.sudo()"/>
                    </t>
                </div>
                <!-- chatter -->
                <div id="request_communication" class="mt-4">
                    <h2>History</h2>
                    <t t-call="portal.message_thread">
                        <t t-set="object" t-value="radiology_request"/>
                    </t>
                </div>
            </div>
        </t>
    </template>

</odoo>
```

  File: views/radiology_patient_test_view.xml
  Content:
```
<?xml version="1.0"?>
<odoo>
    
    <!--Patient Test Results-->
    <record id="patient_radiology_test_view" model="ir.ui.view">
        <field name="name">Radiology Test</field>
        <field name="model">patient.radiology.test</field>
        <field name="arch" type="xml">
            <form string="Radiology Test">
                <header>
                    <button name="action_done" invisible="state != 'draft'" string="Done" type="object" class="oe_highlight"/>
                    <button name="action_cancel" invisible="state != 'draft'" string="Cancel" type="object"/>
                    <button name="action_draft" invisible="state == 'draft'"  string="Draft" type="object" class="oe_highlight"/>
                    <button name="action_radiology_test_send" string="Send by Email" type="object" invisible="state == 'draft'"/>
                    <field name="state" widget="statusbar" statusbar_visible="draft,done"/>
                </header>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button class="oe_stat_button" type="object"
                        name="action_view_attachments" icon="fa-files-o">
                            <field string="Documents" name="attach_count" widget="statinfo"/>
                        </button>
                        <button class="oe_stat_button" type="object"
                            name="acs_action_attachments_preview" icon="fa-files-o" string="Imaging">
                        </button>
                    </div>
                    <h1>
                        <field name="name" class="oe_inline"/>
                    </h1>
                    <group>
                        <group>
                            <field name="patient_id" readonly="state!='draft'"/>
                            <field name="test_id" required="1" readonly="state!='draft'"/>
                            <field name="physician_id" readonly="state!='draft'"/>
                        </group>
                        <group>
                            <field name="user_id" required="1" readonly="state!='draft'"/>
                            <!-- ACS: Can be validated before marking as done? -->
                            <field name="radiology_physician_id" readonly="state!='draft'"/>
                            <field name="date_requested" readonly="state!='draft'"/>
                            <field name="date_analysis" readonly="state!='draft'"/>
                        </group>
                    </group>
                    <notebook >
                        <page name="diagnosis" string="Diagnosis">
                            <field name="diagnosis" placeholder="Diagnosis" readonly="state!='draft'"/>
                        </page>
                        <page name="consumed_material" string="Consumed Material">
                            <field name="consumable_line_ids" readonly="state!='draft'" nolabel="1" colspan="2"  context="{'default_patient_id': patient_id, 'default_physician_id': radiology_physician_id}">
                                <tree string="Line" editable="top">
                                    <field name="product_id" required="1"/>
                                    <field name="product_uom_id" required="1" groups="uom.group_uom"/>
                                    <field name="qty" required="1"/>
                                    <field name="lot_id" context="{'acs_product_id': product_id}" options="{'no_create': True}" readonly="tracking=='none'" required="tracking!='none'"/>
                                    <field name="date" required="1"/>
                                    <field name="price_unit" readonly="1" force_save="1"/>
                                    <field name="subtotal" readonly="1" sum="Total" optional="show"/>
                                    <field name="tracking" column_invisible="1"/>
                                    <field name="product_uom_category_id" column_invisible="1"/>
                                    <field name="pricelist_id" column_invisible="1"/>
                                    <field name="move_id" column_invisible="1"/>
                                    <field name="physician_id" column_invisible="1"/>
                                    <field name="patient_id" invisible="1"/>
                                </tree>
                            </field>
                        </page>
                        <page name="other_info" string="Other Information">
                            <group>
                                <group>
                                    <field name="radiology_request_id" readonly="state!='draft'" domain="[('patient_id','=',patient_id)]"/>
                                </group>
                                <group>
                                    <field name="company_id" readonly="state!='draft'" groups="base.group_multi_company" options="{'no_create': True}"/>
                                </group>
                            </group>
                        </page>
                    </notebook>
                    
                    <field name="note" readonly="state!='draft'" placeholder="Extra Note"/>
                    <field name="disclaimer" readonly="state!='draft'" placeholder="Disclaimer" nolabel="1" colspan="2"/>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers"/>
                    <field name="activity_ids" widget="mail_activity"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
            </form>
        </field>
    </record>

    <record id="patient_radiology_test_tree" model="ir.ui.view">
        <field name="name">Radiology Test</field>
        <field name="model">patient.radiology.test</field>
        <field name="arch" type="xml">
            <tree string="Radiology Test">
                <field name="name"/>
                <field name="test_id"/>
                <field name="patient_id"/>
                <field name="date_analysis"/>
                <field name="company_id" groups="base.group_multi_company"/>
                <field name="state" decoration-info="state=='draft'" decoration-danger="state=='cancel'" decoration-success="state=='done'" widget="badge"/>
            </tree>
        </field>
    </record>

    <record id="view_hms_patient_radiology_test_search" model="ir.ui.view">
        <field name="name">patient.radiology.test.search</field>
        <field name="model">patient.radiology.test</field>
        <field name="arch" type="xml">
            <search string="Patient Laboratry Test Results">
                <field name="name"/>
                <field name="test_id"/>
                <field name="patient_id"/>
                <field name="date_analysis"/>
                <group expand="0" string="Group By">
                    <filter name="group_by_patient_id" string="Patient" context="{'group_by':'patient_id'}"/>
                    <filter name="group_by_radiology_test" string="Radiology Request" context="{'group_by':'radiology_request_id'}"/>
                    <filter name="group_by_test" string="Test" context="{'group_by':'test_id'}"/>
                    <filter name="group_by_user" string="Tested By" context="{'group_by':'user_id'}"/>
                    <filter name="group_by_req" string=" Prescribing Doctor" context="{'group_by':'physician_id'}"/>
                    <filter name="group_by_state" string="State" context="{'group_by':'state'}"/>
                </group>
            </search>
        </field>
    </record>

    <record id="view_patient_radiology_test_calendar" model="ir.ui.view">
        <field name="name">patient.radiology.test.calendar</field>
        <field name="model">patient.radiology.test</field>
        <field name="type">calendar</field>
        <field name="arch" type="xml">
            <calendar string="Patient Radiology Test" color="physician_id" date_start="date_requested">
                <field name="physician_id"/>
                <field name="patient_id"/>
                <field name="state"/>
            </calendar>
        </field>
    </record>

    <record id="patient_radiology_test_pivot" model="ir.ui.view">
        <field name="name">patient.radiology.test.pivot</field>
        <field name="model">patient.radiology.test</field>
        <field name="arch" type="xml">
            <pivot string="Patient Radiology Test">
                <field name="date_analysis" type="row"/>
                <field name="physician_id" type="row"/>
                <field name="patient_id" type="row"/>
            </pivot>
        </field>
    </record>

    <record id="action_radiology_result" model="ir.actions.act_window">
        <field name="name">Radiology Test Results</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">patient.radiology.test</field>
        <field name="view_mode">tree,form,calendar,pivot</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No Record Found
            </p>
            <p>
                Click to add new Radiology Test Result.
            </p>
        </field>
    </record>

</odoo>
```

  File: views/radiology_request_view.xml
  Content:
```
<?xml version="1.0"?>
<odoo>

    <record id="patient_radiology_test_request_form" model="ir.ui.view">
        <field name="name">Test Requests</field>
        <field name="model">acs.radiology.request</field>
        <field name="arch" type="xml">
            <form string="Radiology Requests">
                <header>
                    <button name="button_requested" invisible="state!='draft'" string="Submit Request" class="oe_highlight" type="object"/>
                    <button name="button_accept" invisible="state!='requested'" string="Accept" type="object" class="oe_highlight" groups="acs_radiology.group_hms_radiology_user"/>
                    <button name="button_in_progress" invisible="state!='accepted'" string="In Progress" class="oe_highlight" type="object" groups="acs_radiology.group_hms_radiology_user"/>
                    <button name="button_done" invisible="state!='in_progress'" string="Done" class="oe_highlight" type="object" groups="acs_radiology.group_hms_radiology_user"/>
                    <button name="create_invoice" string="Create Invoice" invisible="not acs_show_create_invoice" type="object" class="oe_highlight" groups="account.group_account_invoice"/>
                    <button name="button_cancel" invisible="state not in ('requested','accepted','in_progress')" string="Cancel" type="object" groups="acs_radiology.group_hms_radiology_user"/>
                    <button name="button_draft" invisible="state != 'cancel'" string="Reset To Draft" type="object" groups="acs_radiology.group_hms_radiology_user"/>
                    <field name="state" widget="statusbar" statusbar_visible="draft,requested,accepted,in_progress,done"/>
                </header>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button type="object" class="oe_stat_button" icon="fa-money" name="view_invoice" groups="account.group_account_invoice" invisible="not invoice_id">
                            <field string="Invoices" name="invoice_count" widget="statinfo"/>
                        </button>
                        <button name="action_view_test_results" string="Test Results" class="oe_stat_button" icon="fa-flask" type="object" invisible="state not in ('in_progress','to_invoice','done')"/>
                    </div>
                    <h1>
                        <field name="name" class="oe_inline"/>
                    </h1>
                    <group>
                        <group>
                            <field name="patient_id" readonly="state != 'draft'"/>
                            <field name="patient_age"/>
                            <field name="acs_show_create_invoice" invisible="1"/>
                            <field name="date" readonly="state != 'draft'"/>
                            <field name="physician_id" readonly="state != 'draft'"/>
                            <field name="radiology_group_id" readonly="state != 'draft'"/>
                            <field name="is_group_request" readonly="state != 'draft'"/>
                            <field name="group_patient_ids" readonly="state != 'draft'" widget="many2many_tags" invisible="not is_group_request" required="is_group_request"/>
                        </group>
                        <group>
                        </group>
                    </group>
                    <notebook>
                        <page string="Lines" name="lines">
                            <group>
                                <field name="line_ids" nolabel="1" colspan="2" readonly="state != 'draft'">
                                    <tree string="Lines" editable="bottom">
                                        <field name="test_id" string="Test"/>
                                        <field name="acs_tat" optional="show"/>
                                        <field name="sale_price" force_save="1" readonly="not is_manager"/>
                                        <field name="quantity" column_invisible="not parent.is_group_request"/>
                                        <field name="instruction"/>
                                        <field name="amount_total"  column_invisible="not parent.is_group_request" />
                                        <field name="is_manager" invisible="1"/>
                                    </tree>
                                </field>
                                <group class="oe_subtotal_footer oe_right">
                                    <field name="total_price"/>
                                </group>
                            </group>
                        </page>
                        <page string="Other Information" name="other_info">
                            <group>
                                <group>
                                    <label for="invoice_exempt"/>
                                    <div name='invoice_exemption'>
                                        <field name='invoice_exempt' class="oe_inline" nolabel="1" readonly="1"/>
                                        <button name="acs_apply_invoice_exemption" string="Apply/Remove" type="object" class="oe_inline fa fa-arrow-right oe_link" invisible="invoice_id" groups="acs_hms_base.group_acs_invoice_exemption"/>
                                    </div>
                                    <field name="invoice_id" invisible="1"  readonly="state != 'draft'"/>
                                </group>
                                <group>
                                    <field name="acs_radiology_invoice_policy" invisible="1"/>
                                    <field name="payment_state" invisible="1"/>                    
                                    <label for="pricelist_id" groups="product.group_product_pricelist" />
                                    <div name='pricelist_id' groups="product.group_product_pricelist" >
                                        <field name="pricelist_id" options="{'no_open':True, 'no_create': True}" class="oe_inline"/>
                                        <button name="acs_update_price" string="Update Price" type="object" class="oe_inline fa fa-arrow-right oe_link" invisible="not pricelist_id"/>
                                    </div>
                                    <field name="company_id" groups="base.group_multi_company" options="{'no_create': True}" readonly="state != 'draft'"/>
                                    <field name="company_id" invisible="1"/>
                                </group>
                            </group>
                        </page>
                    </notebook>
                    <field name="notes" readonly="state != 'draft'" placeholder="Notes" nolabel="1" colspan="2"/>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers"/>
                    <field name="activity_ids" widget="mail_activity"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
            </form>
        </field>
    </record>

    <record id="patient_radiology_test_request_tree" model="ir.ui.view">
        <field name="name">Test Requests</field>
        <field name="model">acs.radiology.request</field>
        <field name="arch" type="xml">
            <tree string="Test Requests" decoration-info="state=='draft'" decoration-muted="state=='cancel'" decoration-danger="state=='waiting'" name="request_tree">
                <field name="name"/>
                <field name="patient_id"/>
                <field name="date"/>
                <field name="physician_id"/>
                <field name="activity_ids" widget="list_activity" optional="show"/>
                <field name="company_id" groups="base.group_multi_company"/>
                <field name="state" string="Status" decoration-info="state=='draft'" decoration-danger="state=='cancel'" decoration-success="state=='done'" decoration-primary="state=='in_progress'" decoration-warning="state=='requested'" decoration-it="state=='accepted'" widget="badge"/>
            </tree>
        </field>
    </record>

    <record id="view_acs_radiology_request_search" model="ir.ui.view">
        <field name="name">acs.radiology.request.search</field>
        <field name="model">acs.radiology.request</field>
        <field name="arch" type="xml">
            <search string="Patient Radiology Test">
                <field name="name"/>
                <field name="patient_id"/>
                <field name="physician_id"/>
                <filter name="draft" string="Draft" domain="[('state','=','draft')]"/>
                <filter name="done" string="Done" domain="[('state','=','done')]"/>
                <filter name="invoiced" string="Invoiced" domain="[('state','=','invoiced')]"/>
                <filter name="invoice_exempt" string="Invoice Exempt" domain="[('state','=','invoice_exempt')]"/>
                <filter name="today" string="Today's Investigation" domain="[('date','&gt;=', datetime.datetime.combine(context_today(), datetime.time(0,0,0))), ('date','&lt;=', datetime.datetime.combine(context_today(), datetime.time(23,59,59)))]"/>
                <filter name="tomorrow" string="Tomorrow's Investigation" domain="[('date','&gt;=', datetime.datetime.combine(context_today(), datetime.time(0,0,0))+relativedelta(days=1)), ('date','&lt;=', datetime.datetime.combine(context_today(), datetime.time(23,59,59))+relativedelta(days=1))]"/>
                <separator/>
                <group expand="0" string="Group By">
                    <filter name="group_by_patient_id" string="Patient" context="{'group_by':'patient_id'}"/>
                    <filter name="group_by_date" string="Date" context="{'group_by':'date'}"/>
                    <filter name="group_by_physician" string="Doctor" context="{'group_by':'physician_id'}"/>
                    <filter name="group_by_company" string="Institution" context="{'group_by':'company_id'}"/>
                    <filter name="group_by_state" string="Status" context="{'group_by':'state'}"/>
                </group>
            </search>
        </field>
    </record>

    <record id="view_acs_radiology_request_calendar" model="ir.ui.view">
        <field name="name">acs.radiology.request.calendar</field>
        <field name="model">acs.radiology.request</field>
        <field name="type">calendar</field>
        <field name="arch" type="xml">
            <calendar string="Patient Radiology Test" color="physician_id" date_start="date">
                <field name="physician_id"/>
                <field name="patient_id"/>
                <field name="state"/>
            </calendar>
        </field>
    </record>

    <record id="acs_radiology_request_pivot" model="ir.ui.view">
        <field name="name">acs.radiology.request.pivot</field>
        <field name="model">acs.radiology.request</field>
        <field name="arch" type="xml">
            <pivot string="Patient Radiology Test">
                <field name="date" type="row"/>
                <field name="physician_id" type="row"/>
                <field name="patient_id" type="row"/>
            </pivot>
        </field>
    </record>

    <record id="hms_action_radiology_request" model="ir.actions.act_window">
        <field name="name">Radiology Requests</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">acs.radiology.request</field>
        <field name="view_mode">tree,form,calendar,pivot</field>
        <field name="context">{'search_default_today': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No Record Found
            </p>
            <p>
                Click to add new Radiology Request.
            </p>
        </field>
    </record>

    <!-- Radiology Request Group -->
    <record id="view_radiology_group_tree" model="ir.ui.view">
        <field name="name">radiology.group.tree</field>
        <field name="model">radiology.group</field>
        <field name="arch" type="xml">
            <tree string="Line">
                <field name="name"/>
            </tree>
        </field>
    </record>

    <record id="view_radiology_group_form" model="ir.ui.view">
        <field name="name">radiology.group.form</field>
        <field name="model">radiology.group</field>
        <field name="arch" type="xml">
            <form string="Radiology Group">
                <sheet>
                    <div class="oe_title">
                        <label for="name" string="Name" class="oe_edit_only"/>
                        <h1>
                            <field name="name" placeholder="Test Group Name"/>
                        </h1>
                    </div>
                    <group>
                    </group>
                    <field name="line_ids">
                        <tree string="Lines" editable="bottom">
                            <field name="test_id" string="Test"/>
                            <field name="acs_tat" optional="show"/>
                            <field name="sale_price"/>
                            <field name="instruction"/>
                        </tree>
                    </field>
                </sheet>
            </form>
        </field>
    </record>

    <record id="action_radiology_group" model="ir.actions.act_window">
        <field name="name">Radiology Group</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">radiology.group</field>
        <field name="view_mode">tree,form</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No Record Found
            </p>
            <p>
                Click to add new Radiology Group.
            </p>
        </field>
    </record>

</odoo>
```

  File: views/radiology_test_view.xml
  Content:
```
<?xml version="1.0"?>
<odoo>

    <!-- Radiology Test type -->
    <record id="hms_test_view" model="ir.ui.view">
        <field name="name">Radiology Test</field>
        <field name="model">acs.radiology.test</field>
        <field name="arch" type="xml">
            <form string="Radiology Tests">
                <sheet>
                    <widget name="web_ribbon" title="Archived" bg_color="bg-danger" invisible="active"/>
                    <group>
                        <group>
                            <field name="name" required="1"/>
                            <field name="product_id" domain="[('type','=','service'), ('hospital_product_type', 'in', [ 'radiology'])]" context="{'default_detailed_type': 'service', 'default_hospital_product_type': 'radiology'}"/>
                            <field name="list_price"/>
                        </group>
                        <group>
                            <field name="code"/>
                            <field name="acs_tat"/>
                        </group>
                    </group>

                    <notebook>
                        <page name="consumable_lines" string="Consumed Material">
                            <field name="consumable_line_ids" nolabel="1" colspan="2">
                                <tree string="Line" editable="top">
                                    <field name="product_id" expand="1" required="1"/>
                                    <field name="product_uom_id" required="1" groups="uom.group_uom"/>
                                    <field name="qty" required="1"/>
                                    <field name="tracking" column_invisible="1"/>
                                    <field name="product_uom_category_id" column_invisible="1"/>
                                    <field name="move_id" column_invisible="1"/>
                                </tree>
                            </field>
                        </page>
                        <page name="other_info" string="Other Information">
                            <group>
                                <group>
                                    <field name="company_id" groups="base.group_multi_company" options="{'no_create': True}"/>
                                    <!-- <field name="subsequent_test_ids" widget="many2many_tags"/> -->
                                </group>
                                <group>
                                    <field name="active" invisible="1"/>
                                </group>
                            </group>
                        </page>
                    </notebook>
                    <field name="description" placeholder="Description"/>
                </sheet>
            </form>
        </field>
    </record>

    <record id="hms_test_tree" model="ir.ui.view">
        <field name="name">Radiology Tests</field>
        <field name="model">acs.radiology.test</field>
        <field name="arch" type="xml">
            <tree string="Radiology Test">
                <field name="name"/>
                <field name="code"/>
                <field name="list_price"/>
                <field name="active" column_invisible="1"/>
            </tree>
        </field>
    </record>

    <record id="action_radiology_test" model="ir.actions.act_window">
        <field name="name">Radiology Tests</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">acs.radiology.test</field>
        <field name="view_mode">tree,form</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No Record Found
            </p>
            <p>
                Click to add new Radiology Test.
            </p>
        </field>
    </record>

</odoo>
```

  File: views/radiology_view.xml
  Content:
```
<?xml version="1.0"?>
<odoo>

    <!-- Radiology -->
    <record id="view_acs_radiology_tree" model="ir.ui.view">
        <field name="name">acs.radiology.tree</field>
        <field name="model">acs.radiology</field>
        <field name="arch" type="xml">
            <tree>
                <field name="name"/>
                <field name="partner_id"/>
                <field name="description"/>
                <field name="is_collection_center"/>
                <field name="company_id" groups="base.group_multi_company" options="{'no_create': True}"/>
            </tree>
        </field>
    </record>

    <record id="view_acs_radiology_form" model="ir.ui.view">
        <field name="name">acs.radiology.form</field>
        <field name="model">acs.radiology</field>
        <field name="arch" type="xml">
            <form>
                <sheet>
                    <group>
                        <field name="name" required="1"/>
                        <field name="partner_id" readonly="1" required="0"/>
                        <field name="is_collection_center"/>
                        <field name="company_id" groups="base.group_multi_company" options="{'no_create': True}"/>
                    </group>
                    <group>
                        <field name="description"/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <record id="action_acs_radiology" model="ir.actions.act_window">
        <field name="name">Radiology</field>
        <field name="res_model">acs.radiology</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('is_collection_center','=',False)]</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Click to add a new Radiology.
            </p>
        </field>
    </record>

    <record id="action_acs_collection_center" model="ir.actions.act_window">
        <field name="name">Collection Center</field>
        <field name="res_model">acs.radiology</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('is_collection_center','=',True)]</field>
        <field name="context">{'default_is_collection_center':True}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Click to add a new Collection Center.
            </p>
        </field>
    </record>

</odoo>
```

  File: views/res_config.xml
  Content:
```
<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="res_config_settings_view_form" model="ir.ui.view">
        <field name="name">res.config.settings.view.form.inherit.radiology</field>
        <field name="model">res.config.settings</field>
        <field name="priority" eval="10"/>
        <field name="inherit_id" ref="acs_hms_base.res_config_settings_view_form"/>
        <field name="arch" type="xml">
            <xpath expr="//div[@id='radiology']" position="after">
                <block title="Radiology" name="radiology_setting_container">
                    <setting help="Location to take consumed Material in Radiology Test." id="acs_radiology_stock_location_id_setting">
                        <field name="acs_radiology_stock_location_id" class="o_light_label" string="Stock Location"/>
                    </setting>
                    <setting help="Location to manage consumed Material in Radiology Test." id="acs_radiology_usage_location_id_setting">
                        <field name="acs_radiology_usage_location_id" class="o_light_label" string="Stock Usage Location"/>
                    </setting>
                    <setting help="Allow user to Autheticate Radiology Result by scanning QrCode from report." id="acs_radiology_result_qrcode_setting">
                        <field name="acs_radiology_result_qrcode" class="o_light_label" string="Radiology Result Authentication"/>
                    </setting>
                    <setting help="Based on Configured option Create Invoice option will be shown on Radiology request." id="acs_radiology_invoice_policy_setting">
                        <field name="acs_radiology_invoice_policy" class="o_light_label" string="Invoice Policy"/>
                    </setting>
                    <setting  invisible="acs_radiology_invoice_policy!='in_advance'"  help="Do not allow to accept request before completion of payment." id="acs_check_radiology_payment_setting">
                        <field name="acs_check_radiology_payment" class="o_light_label" string="Check Payment Status"/>
                    </setting>
                    <setting help="It will set this disclaimer by default on lab Result &amp; Request Records." id="acs_radiology_disclaimer_setting">
                        <field name="acs_radiology_disclaimer" placeholder="Instert Your Default Disclaimer here.." class="o_light_label" string="Default Disclaimer"/>
                    </setting>
                </block>
            </xpath>
        </field>
    </record>

</odoo>

```

  File: views/templates_view.xml
  Content:
```
<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <template id="acs_radiology_result_details" name="Radiology Detail">
        <t t-call="website.layout">
            <div id="wrap">
                <div class="container">
                    <div id="labresult_content" class="col-12 col-lg mt32 mb64 o_portal_html_view shadow p-3" style="background-color: white;">
                        <t t-call="acs_radiology.report_acs_radiology_test_document">
                            <t t-set="doc" t-value="labresult.sudo()"/>
                        </t>
                    </div>
                </div>
            </div>
        </t>
    </template>

</odoo>

```

Controllers:
  File: controllers/__init__.py
  Content:
```
# -*- coding: utf-8 -*-

from . import main

# vim:expandtab:smartindent:tabstop=4:softtabstop=4:shiftwidth=4:
```

  File: controllers/main.py
  Content:
```
# -*- coding: utf-8 -*-

from odoo import http, fields, _
from odoo.http import request
from odoo.tools import DEFAULT_SERVER_DATETIME_FORMAT
from odoo.exceptions import AccessError, MissingError
from odoo.addons.portal.controllers.portal import CustomerPortal, pager as portal_pager, get_records_pager
from odoo import fields as odoo_fields, http, tools, _, SUPERUSER_ID
import base64

class ACSHms(http.Controller):

    @http.route(['/validate/patientradiologytest/<labresult_unique_code>'], type='http', auth="public", website=True, sitemap=False)
    def labresult_details(self, labresult_unique_code, **post):
        if labresult_unique_code:
            labresult = request.env['patient.radiology.test'].sudo().search([('unique_code','=',labresult_unique_code)], limit=1)
            if labresult:
                return request.render("acs_radiology.acs_radiology_result_details", {'labresult': labresult})
        return request.render("acs_hms.acs_no_details")


class HMSPortal(CustomerPortal):

    def _prepare_home_portal_values(self, counters):
        values = super()._prepare_home_portal_values(counters)
        RadiologyTest = request.env['patient.radiology.test']
        if 'radiology_result_count' in counters:
            values['radiology_result_count'] = RadiologyTest.search_count([]) \
                if RadiologyTest.check_access_rights('read', raise_exception=False) else 0

        RadiologyRequest = request.env['acs.radiology.request']
        if 'radiology_request_count' in counters:
            values['radiology_request_count'] = RadiologyRequest.search_count([]) \
                if RadiologyRequest.check_access_rights('read', raise_exception=False) else 0
        return values

    #Radiology Result
    @http.route(['/my/radiology_results', '/my/radiology_results/page/<int:page>'], type='http', auth="user", website=True, sitemap=False)
    def my_radiology_results(self, page=1, sortby=None, **kw):
        values = self._prepare_portal_layout_values()
        RadiologyTest = request.env['patient.radiology.test']
        if not sortby:
            sortby = 'date'

        sortings = {
            'date': {'label': _('Newest'), 'order': 'date_analysis desc'},
            'name': {'label': _('Name'), 'order': 'name'},
        }

        order = sortings.get(sortby, sortings['date'])['order']
        count = RadiologyTest.search_count([])
 
        pager = portal_pager(
            url="/my/radiology_results",
            url_args={},
            total=count,
            page=page,
            step=self._items_per_page
        )
        # content according to pager and archive selected

        radiology_results = RadiologyTest.search([],
            order=order, limit=self._items_per_page, offset=pager['offset'])

        values.update({
            'sortings': sortings,
            'sortby': sortby,
            'radiology_results': radiology_results,
            'page_name': 'radiology_result',
            'default_url': '/my/radiology_results',
            'searchbar_sortings': sortings,
            'pager': pager
        })
        return request.render("acs_radiology.radiology_results", values)

    @http.route(['/my/radiology_results/<int:result_id>'], type='http', auth="user", website=True, sitemap=False)
    def my_radiology_test_result(self, result_id=None, access_token=None, **kw):
        try:
            order_sudo = self._document_check_access('patient.radiology.test', result_id, access_token=access_token)
        except (AccessError, MissingError):
            return request.redirect('/my')

        if order_sudo.attachment_ids:
            for att in order_sudo.attachment_ids:
                att._acs_portal_ensure_token()

        return request.render("acs_radiology.my_radiology_test_result", {'radiology_result': order_sudo})

    #Radiology Request
    @http.route(['/my/radiology_requests', '/my/radiology_requests/page/<int:page>'], type='http', auth="user", website=True, sitemap=False)
    def my_radiology_requests(self, page=1, sortby=None, **kw):
        values = self._prepare_portal_layout_values()
        RadiologyReq = request.env['acs.radiology.request']
        if not sortby:
            sortby = 'date'

        sortings = {
            'date': {'label': _('Newest'), 'order': 'date desc'},
            'name': {'label': _('Name'), 'order': 'name'},
        }

        order = sortings.get(sortby, sortings['date'])['order']
        count = RadiologyReq.search_count([])
 
        pager = portal_pager(
            url="/my/radiology_requests",
            url_args={},
            total=count,
            page=page,
            step=self._items_per_page
        )
        # content according to pager and archive selected
        radiology_requests = RadiologyReq.search([],
            order=order, limit=self._items_per_page, offset=pager['offset'])

        values.update({
            'sortings': sortings,
            'sortby': sortby,
            'radiology_requests': radiology_requests,
            'page_name': 'radiology_request',
            'default_url': '/my/radiology_requests',
            'searchbar_sortings': sortings,
            'pager': pager
        })
        return request.render("acs_radiology.radiology_requests", values)

    @http.route(['/my/radiology_requests/<int:radiology_request_id>'], type='http', auth="user", website=True, sitemap=False)
    def my_radiology_test_request(self, radiology_request_id=None, access_token=None, **kw):
        try:
            order_sudo = self._document_check_access('acs.radiology.request', radiology_request_id, access_token=access_token)
        except (AccessError, MissingError):
            return request.redirect('/my')

        return request.render("acs_radiology.my_radiology_test_request", {'radiology_request': order_sudo})

# vim:expandtab:smartindent:tabstop=4:softtabstop=4:shiftwidth=4:
```

Security:
  File: security/security.xml
  Content:
```
<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="0">

        <record id="acs_radiology_category" model="ir.module.category">
            <field name="name">Radiology System</field>
            <field name="description">Manage Radiology Documents.</field>
            <field name="sequence">11</field>
            <field name="parent_id" ref="acs_hms_base.module_category_hms"/>
        </record>

        <!-- RADIOLOGY -->
        <record id="group_hms_radiology_user" model="res.groups">
            <field name="name">User</field>
            <field name="category_id" ref="acs_radiology_category"/>
            <field name="implied_ids" eval="[(4, ref('acs_hms_base.group_hms_user'))]"/>
        </record>

        <record id="group_hms_radiology_manager" model="res.groups">
            <field name="name">Manager</field>
            <field name="category_id" ref="acs_radiology_category"/>
            <field name="implied_ids" eval="[(4, ref('group_hms_radiology_user'))]"/>
        </record>

        <record id="base.user_admin" model="res.users">
            <field name="groups_id" eval="[(4, ref('acs_radiology.group_hms_radiology_manager'))]"/>
        </record>

        <record id="acs_hms_base.group_hms_manager" model="res.groups">
            <field name="implied_ids" eval="[(4, ref('acs_radiology.group_hms_radiology_manager'))]"/>
        </record>

    </data>
    <data noupdate="0">

        <!-- Radiology Req Rules-->
        <!-- See Radiology Req -->
        <record id="all_hms_radiology_request_rule" model="ir.rule">
            <field name="name">All Radiology Requests</field>
            <field name="model_id" ref="model_acs_radiology_request"/>
            <field name="domain_force">[(1,'=',1)]</field>
            <field name="groups" eval="[(4, ref('group_hms_radiology_user'))]"/>
        </record>
        <!-- Radiology Result Rules-->
        <record id="all_patient_radiology_test_rule" model="ir.rule">
            <field name="name">All Radiology Result</field>
            <field name="model_id" ref="model_patient_radiology_test"/>
            <field name="domain_force">[(1,'=',1)]</field>
            <field name="groups" eval="[(4, ref('group_hms_radiology_user'))]"/>
        </record>

        <record id="radiology_req_cal_comp_rule" model="ir.rule">
            <field name="name">Radiology Request multi-company</field>
            <field name="model_id" ref="model_acs_radiology_request"/>
            <field name="domain_force">['|',('company_id','=',False),('company_id', 'in', company_ids)]</field>
        </record>
        <record id="radiology_test_comp_rule" model="ir.rule">
            <field name="name">Patient Radiology Test multi-company</field>
            <field name="model_id" ref="model_patient_radiology_test"/>
            <field name="domain_force">['|',('company_id','=',False),('company_id', 'in', company_ids)]</field>
        </record>
        <record id="radiology_comp_rule" model="ir.rule">
            <field name="name">Radiology Test multi-company</field>
            <field name="model_id" ref="model_acs_radiology_test"/>
            <field name="domain_force">['|',('company_id','=',False),('company_id', 'in', company_ids)]</field>
        </record>
        <record id="acs_radiology_comp_rule" model="ir.rule">
            <field name="name">Radiology multi-company</field>
            <field name="model_id" ref="model_acs_radiology"/>
            <field name="domain_force">['|',('company_id','=',False),('company_id', 'in', company_ids)]</field>
        </record>

        <!-- Portal -->
        <record id="hms_radiology_request_portal_rule_1" model="ir.rule">
            <field name="name">Portal Patient's Own Radiology Req</field>
            <field name="model_id" ref="acs_radiology.model_acs_radiology_request"/>
            <field name="domain_force">[('patient_id.partner_id','=',user.commercial_partner_id.id)]</field>
            <field name="groups" eval="[(4, ref('base.group_portal'))]"/>
            <field name="perm_unlink" eval="False"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_create" eval="False"/>
        </record>

        <record id="hms_radiology_test_portal_rule_1" model="ir.rule">
            <field name="name">Portal Patient's Own Radiology test</field>
            <field name="model_id" ref="acs_radiology.model_patient_radiology_test"/>
            <field name="domain_force">['|',('radiology_request_id.patient_id.partner_id','=',user.commercial_partner_id.id),('patient_id.partner_id','=',user.commercial_partner_id.id)]</field>
            <field name="groups" eval="[(4, ref('base.group_portal'))]"/>
            <field name="perm_unlink" eval="False"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_create" eval="False"/>
        </record>

    </data>
</odoo>

```

Data:
  File: data/data.xml
  Content:
```
<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="1">


        <record id="seq_radiology_request_sequence" model="ir.sequence">
            <field name="name">Radiology Request</field>
            <field name="code">acs.radiology.request</field>
            <field name="prefix">RR</field>
            <field name="padding">3</field>
            <field name="acs_auto_create" eval="True"/>
            <field name="company_id" eval="False"/>
        </record>

        <record id="seq_patient_radiology_test" model="ir.sequence">
            <field name="name">Patient Radiology Test</field>
            <field name="code">patient.radiology.test</field>
            <field name="prefix">RRR</field>
            <field name="padding">3</field>
            <field name="acs_auto_create" eval="True"/>
            <field name="company_id" eval="False"/>
        </record>

        <record id="base.main_company" model="res.company" >
            <field name="acs_radiology_usage_location_id" ref="stock.stock_location_customers"/>
            <field name="acs_radiology_stock_location_id" ref="stock.stock_location_stock"/>
        </record>

        <!-- Lab-related subtypes for messaging / Chatter -->
        <record id="mt_radiology_test_done" model="mail.message.subtype">
            <field name="name">Radiology Test is Done</field>
            <field name="res_model">patient.radiology.test</field>
            <field name="default" eval="False"/>
            <field name="description">Radiology Test is Done</field>
        </record>

    </data>
</odoo>

```

  File: data/digest_data.xml
  Content:
```
<?xml version='1.0' encoding='utf-8'?>
<odoo>

    <record id="digest.digest_digest_default" model="digest.digest">
        <field name="kpi_acs_radiology_test_total">True</field>
    </record>

</odoo>
```

  File: data/mail_template.xml
  Content:
```
<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="0">

        <record id="acs_radiology_req_email" model="mail.template">
            <field name="name">Radiology Request</field>
            <field name="email_from">{{ user.email_formatted }}</field>
            <field name="email_to">{{ object.patient_id.email }}</field>
            <field name="subject">Radiology Test Request: {{ object.name }}</field>
            <field name="model_id" ref="acs_radiology.model_acs_radiology_request"/>
            <field name="report_template_ids" eval="[(4, ref('acs_radiology.action_report_acs_radiology_prescription'))]"/>
            <field name="lang">{{ object.patient_id.lang }}</field>
            <field name="body_html" type="html">
<div style="padding:0px;margin:auto;background: #FFFFFF repeat top /100%;color:#777777">
    <p>Hello <t t-out="object.patient_id.name"/>,</p>
    <p>We will like to perform lab tests requested in the attached document in your radiology and revert-us back on this mail with findings.</p>
    <ul>
        <li>
            <p>Reference Number: <t t-out="object.name"/></p>
        </li>
        <li t-if="object.patient_id">
            <p>Patient: <t t-out="object.patient_id.name"/></p>
        </li>
        <li t-if="object.physician_id">
            <p>Prescribed By: <t t-out="object.physician_id.name"/></p>
        </li>
        <li>
            <p>Prescription Date: <t t-out="object.date.date()"/></p>
        </li>
    </ul>

    <p>Please feel free to call anytime for further information or any query.</p>

    <p>Best regards.</p>
</div>
                </field>
        </record>

        <record id="acs_radiology_test_email" model="mail.template">
            <field name="name">Radiology Test Result</field>
            <field name="email_from">{{ user.email_formatted }}</field>
            <field name="email_to">{{ object.patient_id.email }}</field>
            <field name="subject">Radiology Test Request: {{ object.name }}</field>
            <field name="model_id" ref="acs_radiology.model_patient_radiology_test"/>
            <field name="report_template_ids" eval="[(4, ref('acs_radiology.action_report_acs_radiology_test'))]"/>
            <field name="lang">{{ object.patient_id.lang }}</field>
            <field name="body_html" type="html">
<div style="padding:0px;margin:auto;background: #FFFFFF repeat top /100%;color:#777777">
    <p>Hello <t t-out="object.patient_id.name"/>,</p><br/>
    <p>We have attached the results of the lab tests requested from our radiology. Please find the attached lab result report.</p><br/>
    <ul>
        <li>
            <p>Reference Number: <t t-out="object.name"/></p>
        </li>
        <li t-if="object.patient_id">
            <p>Patient: <t t-out="object.patient_id.name"/></p>
        </li>
        <li t-if="object.radiology_request_id">
            <p>Radiology Request Reference: <t t-out="object.radiology_request_id.name"/></p>
        </li>
        <li t-if="object.test_id">
            <p>Radiology Test: <t t-out="object.test_id.name"/></p>
        </li>
        <li t-if="object.physician_id">
            <p>Prescribed By: <t t-out="object.physician_id.name"/></p>
        </li>
        <li>
            <p>Test Date: <t t-out="object.date_analysis"/></p>
        </li>
        <li>
            <p>Responsible: <t t-out="object.user_id.name"/></p>
        </li>
    </ul>

    <p>Please feel free to call anytime for further information or any query.</p>

    <p>Best regards.</p><br/>
</div>
                </field>
        </record>
        
    </data>
</odoo>

```

  File: data/radiology_demo.xml
  Content:
```
<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="1">

        <record id="acs_hms_radiology_service_0" model="product.product">
            <field name="name">X-Ray</field>
            <field name="type">service</field>
            <field name="hospital_product_type">radiology</field>
            <field name="list_price">500.0</field>
            <field name="standard_price">500.0</field>       
        </record>

        <record id="acs_radiology_test_x_ray" model="acs.radiology.test">
            <field name="name">X-Ray</field>
            <field name="code">XRay</field>
            <field name="product_id" ref="acs_hms_radiology_service_0"/>
        </record>

    </data>
</odoo>
```

Static:
  File: static/description/index.html
  Content:
```
<head>
  <style>
      .backgrounds{background-color:#fff; color:#0B80E6}
  </style>
</head>

<section class="oe_container">
    <div class="mt32 mb32">
        <div style="background-color: #2d9f9d; background-image: linear-gradient(#918c8c, #2d9f9d); background: linear-gradient(106deg,#918c8c 0%,#2d9f9d 100%); border-radius: 10px 10px 10px 10px; min-height: 160px;">
            <div class="text-white font-weight-bold" style="text-decoration: none; font-size: 14px; padding-top: 10px;">
                <div class="pt-2 text-center">
                    <span>
                    <span class="pt-2 text-center" style="font-size:27px;">Almighty Consulting Solutions Pvt. Ltd.</span><br/>
                </div>
                <div class="row mt16">
                    <div class="col-4 text-center">
                        <span>Supported Editions</span><br/> 
                        <span class="badge badge-pill badge-light" style="background: linear-gradient(106deg,#f9f6f6 0%,#8c8d8d 100%); border-radius: 0.4rem; padding: 1.00em 0.4em; padding-right: 2em; padding-left: 2em;"> 
                                <i class="fa fa-check-circle position-absolute" style="font-size:16px; margin-left:-17px; margin-top:-2px"></i>Community 
                        </span>
                        <span class="badge badge-pill badge-light" style="background: linear-gradient(106deg,#f9f6f6 0%,#8c8d8d 100%); border-radius: 0.4rem; padding: 1.00em 0.4em; padding-right: 2em; padding-left: 2em;"> 
                                <i class="fa fa-check-circle position-absolute" style="font-size:16px; margin-left:-17px; margin-top:-2px"></i>Enterprise 
                        </span>
                    </div>

                    <div class="col-4 text-center">
                        <a href="https://www.almightycs.com" target="_blank">
                            <img src="almightycs.png" width="80" height="auto">
                        </a>
                    </div>

                    <div class="col-4 text-center">
                        <span>Supported Hostings <br/></span>
                        <span class="badge badge-pill badge-light" style="background: linear-gradient(106deg,#f9f6f6 0%,#8c8d8d 100%); border-radius: 0.4rem; padding: 1.00em 0.4em; padding-right: 2em; padding-left: 2em;"> 
                                <i class="fa fa-check-circle position-absolute" style="font-size:16px; margin-left:-17px; margin-top:-2px"></i>Odoo.sh 
                        </span>
                        <span class="badge badge-pill badge-light" style="background: linear-gradient(106deg,#f9f6f6 0%,#8c8d8d 100%); border-radius: 0.4rem; padding: 1.00em 0.4em; padding-right: 2em; padding-left: 2em;"> 
                                <i class="fa fa-check-circle position-absolute" style="font-size:16px; margin-left:-17px; margin-top:-2px"></i>Cloud
                        </span>
                        <span class="badge badge-pill badge-light" style="background: linear-gradient(106deg,#f9f6f6 0%,#8c8d8d 100%); border-radius: 0.4rem; padding: 1.00em 0.4em; padding-right: 2em; padding-left: 2em;"> 
                                <i class="fa fa-check-circle position-absolute" style="font-size:16px; margin-left:-17px; margin-top:-2px"></i>On Premise 
                        </span><br/>
                        <span class="pt-2 text-center" style="font-size:12px;">App can not be used on odoo online.</span><br/>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
 
<section class="oe_container">
    <div class="oe_row oe_spaced">
        <div class="oe_span12 oe_mt32 mb32">
            <h3 class="oe_slogan">Radiology Management System</h3><h4><br/>This Module Adds Hospital Radiology Request, Radiology Tests, Radiology Reports and their Invoicing Related Flow.</h4>
        </div>
    </div> 
</section>

<section class="oe_container">
    <div class="oe_row oe_spaced">
        <div class="oe_demo e_picture o_screenshot">
            <a href="http://www.almightycs.com/blog/blogs-1" target="_blank">
                <img src="hms_menus_odoo_almightycs.png">
            </a>
            <div class="oe_demo_footer oe_centeralign">Radiology Menus.</div>
        </div>
    </div>
</section>

<section class="oe_container mt32 mb32">
    <div class="oe_row oe_spaced">
        <div class='oe_span12 mt92 alert alert-success'>
            <h3 class="text-center"> 
                <i class="fa fa-star fa-spin fa-2x fa-fw"></i>
                What is special from other HMS applications 
                <i class="fa fa-star fa-spin fa-2x fa-fw"></i>
            </h3>
            <hr/>
            <h2><i class="fa fa-hand-o-right text-success"></i> Clean Code</h2>
            <h2><i class="fa fa-hand-o-right text-success"></i> Proper User Roles</h2>
            <h2><i class="fa fa-hand-o-right text-success"></i> Record Rules and Access rights</h2>
            <h2><i class="fa fa-hand-o-right text-success"></i> Clean Form Views</h2>
            <h2><i class="fa fa-hand-o-right text-success"></i> Many more supporting modules to complete flow</h2>
        </div>
    </div>
</section>


<section class="oe_mt32">
    <div class='text-center mt92'>
        <h2> Detailed Description of Module</h2>
    </div>
    <div class="panel-body">
        <div class="alert alert-info">
            <a data-toggle="collapse" href="#acs_radiology_result_details"><i class="fa fa-plus-circle"></i></a>
            <b> Radiology &amp; Diagnostics Management System</b>
            <b style="float:right"><a href="http://www.almightycs.com" target="_blank">By ACS </b>
        </div>
        <div id="acs_radiology_result_details" class="panel-collapse collapse in" class="oe_span12">
            <h3><i class="fa fa-hand-o-right text-success"></i> Radiology Request Management</h3>
            <h3><i class="fa fa-hand-o-right text-success"></i> Patient Radiology Test creation and relatd flow form lab requests.</h3>
            <h3><i class="fa fa-hand-o-right text-success"></i> Radiology Request Report.</h3>
            <h3><i class="fa fa-hand-o-right text-success"></i> Radiology Request Invoicing.</h3>
            <h3><i class="fa fa-hand-o-right text-success"></i> Radiology Test Result Report.</h3>
            <h3><i class="fa fa-hand-o-right text-success"></i> Radiology Test Criterias.</h3>
            <h3><i class="fa fa-hand-o-right text-success"></i> Radiology Tests</h3>
            <h3><i class="fa fa-hand-o-right text-success"></i> Cofigurable invicing policy for lab request.</h3>
            <h3><i class="fa fa-hand-o-right text-success"></i> Manage multiple collection Centers.</h3>
            <h3><i class="fa fa-hand-o-right text-success"></i> Manage option to send lab request to outside laboratry and related billing.</h3>
        </div>
    </div>
</section>

<section>
    <div class="oe_row oe_spaced">
        <h4 class="oe_slogan"><a href="http://www.almightycs.com">Almighty Consulting Solutions Pvt. Ltd.</a> </h4>
    </div>
</section>

<section class="oe_container">
    <div class="oe_row oe_spaced">
        <div class="oe_span12">
            <h3 class="oe_slogan">Other Configuration</h3>
            <p class="oe_slogan">To use this module no technical knowledge is required. Just install module and functionality is ready to use. For more customization and help contact us.</p>
        </div>
    </div>
</section>

<section class="oe_container">
    <div class="oe_row oe_spaced">
        <div class="oe_span6">
            <div class="oe_demo e_picture o_screenshot">
                <a href="https://www.almightycs.com" target="_blank">
                    <img src="acs.png" width="200" height="auto">
                </a>
                <div class="oe_demo_footer oe_centeralign">Meet Us</div>
            </div>
        </div>
        <div class="oe_span6">
            <br/><br/>
            <h2 class="oe_slogan">Do you need help?</h2>
            <h3 class="oe_slogan">
                Let's offer you the best services!
            </h3>
            <p class="oe_mt32 text-center">
                Contact us by our official channels.
            </p>
            <p class="oe_mt32 text-center">
                Skype: turkesh4friends 
            </p>
            <div class="oe_spaced">
                <ul class="text-center list-inline">
                    <li>
                        <a href="https://www.linkedin.com/organization-guest/company/almighty-consulting-services" Target="_blank"><i class="fa fa-linkedin-square fa-xs backgrounds"></i></a>
                    </li>
                    <li>
                        <a href="https://www.facebook.com/AlmightyCS.ERP" Target="_blank"><i class="fa fa-facebook-square fa-xs backgrounds"></i></a>
                    </li>
                    <li>
                        <a href="https://github.com/tpa-odoo" Target="_blank"><i class="fa fa-github-square fa-xs backgrounds"></i></a>
                    </li>
                    <li>
                        <a href="mailto:info@almightycs.com" Target="_blank"><i class="fa fa-envelope-square fa-xs backgrounds"></i></a>
                    </li>
                    <li>
                        <a href="https://twitter.com/_AlmightyCS" Target="_blank" ><i class="fa fa-twitter-square fa-xs backgrounds"></i></a>
                    </li>

                    <li>
                        <a title="Contact us" data-toggle="tooltip" data-placement="left" Target="_blank" href="https://www.almightycs.com/contactus"><i class="fa fa-globe fa-xs backgrounds"></i></a>
                    </li>
                </ul>
            </div>
        </div>

    </div>
</section>

<section class="oe_container">

    <div data-toggle="collapse" href="#contactus-floating" role="button" aria-expanded="true" aria-controls="contactus-floating" style="
            width: 70px;
            height: 70px;
            background: linear-gradient(106deg,#918c8c 0%,#2d9f9d 100%);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: fixed;
            bottom: 10px;
            right: 20px;
            z-index: 1000;
            box-shadow: 1px 2px 11px rgba(0, 0, 0, 0.3), -5px 7px 12px rgba(0, 0, 0, 0.22);
            cursor: pointer;">
        <span class="fa fa-2x fa-handshake-o"></span>
    </div>
    
    <div class="collapse show" id="contactus-floating" style="z-index: 1006; position: fixed; bottom: 10px; right: 20px;">
        <div style="width:246px; overflow: hidden;">
            <div class="text-center acs-contactus-close" data-toggle="collapse" href="#contactus-floating" role="button" aria-expanded="true" aria-controls="contactus-floating" style="
                    width: 25px;
                    height: 25px;
                    margin-bottom: -25px;
                    display: flex;
                    color: white;
                    align-items: center;
                    justify-content: center;
                    position: relative;
                    z-index: 1000;
                    cursor: pointer;">
                <i class="fa fa-times"></i>
            </div>
            <div class="acs-contactus-data" style="
                    margin-top: -17px;
                    background: linear-gradient(106deg,#918c8c 0%,#2d9f9d 100%);
                    border-radius: 10px 10px 10px 10px;
                    padding-bottom: 10px;
                    height: 106px;">
                <div class="text-center" style="text-decoration: none; font-size: 14px; padding-top: 10px;">
                    <span class="pt-2 text-white font-weight-bold" style="">Contact AlmightyCS</span>
                </div>
                <div class="acs-contactus-block" style="padding: 10px; font-size: 14px;">  
                    <a href="skype:turkesh4friends" target="_blank" class="oe_span5 flex-column align-items-center text-white font-weight-light">
                        <i class="fa fa-skype" style="font-size: 22px;"></i>
                        <span class="pt-2 font-weight-bold">Skype</span>
                    </a>
                    <a href="https://www.almightycs.com" target="_blank" class="oe_span7 flex-column align-items-center text-white font-weight-light">
                        <i class="fa fa-globe fa-spin" style="font-size: 22px;"></i>
                        <span class="pt-2 font-weight-bold">Website</span>
                    </a>
                </div>
                <div class="acs-contactus-block" style="padding: 10px; 
                    font-size: 14px; 
                    padding-bottom: 20px; 
                    padding-top: 22px;"> 
                    <a href="mailto:info@almightycs.com" target="_blank" class="oe_span5 flex-column align-items-center text-white font-weight-light">
                        <i class="fa fa-envelope" style="font-size: 19px;"></i>
                        <span class="pt-2 font-weight-bold">Email</span>
                    </a>
                    <a href="https://www.almightycs.com/contactus" target="_blank" class="oe_span7 flex-column align-items-center text-white font-weight-light">
                        <i class="fa fa-handshake-o" style="font-size: 20px;"></i>
                        <span class="pt-2 font-weight-bold">Contactus</span>
                    </a>
                </div>
            </div>
        </div>
    </div> 

</section>
```

Doc:
  File: doc/changelog.rst
  Content:
```
`1.0.3                                                        [12/01/2024]`
***************************************************************************
- Improved code for invocie policy configuration.

`1.0.2                                                        [22/12/2023]`
***************************************************************************
- Improved code for report print.

`1.0.1                                                        [13/10/2023]`
***************************************************************************
- Launched Module for v17.
```

Other_files:
  File: report/radiology_prescription.xml
  Content:
```
<?xml version="1.0" encoding="UTF-8"?>
<odoo>

    <template id="report_radiology_prescription_table">
        <table class="table table-condensed mt16">
            <thead>
                <tr>
                    <th width="30%">Test Name</th>
                    <th>Test Description</th>
                </tr>
            </thead>
            <tbody>
                <t t-foreach="lines" t-as="line">
                    <tr>
                        <td>
                            <span t-esc="line.test_id.name"/>
                        </td>
                        <td>
                            <span t-esc="line.instruction"/>
                        </td>
                    </tr>
                </t>
            </tbody>
        </table>
    </template>

    <template id="report_acs_radiology_prescription_document">
        <t t-call="web.external_layout">
            <t t-set="doc" t-value="doc.with_context({'lang':doc.patient_id.lang})"/>
            <div class="page">
                <div class="oe_structure"/>
                <h2 class="text-center mt32">Radiology Request: <span t-field="doc.name"/></h2>
                <div class="row mt32 mb32" id="informations">
                    <div t-if="doc.patient_id" class="col-3 mb-2">
                        <strong>Patient</strong>
                        <p class="m-0" t-field="doc.patient_id"/>
                    </div>
                    <div t-if="doc.patient_age" class="col-3 mb-2">
                        <strong>Patient Age</strong>
                        <p class="m-0" t-field="doc.patient_age"/>
                    </div>
                    <div t-if="doc.patient_id.gender" class="col-3 mb-2">
                        <strong>Gender</strong>
                        <p class="m-0" t-field="doc.patient_id.gender"/>
                    </div>
                    <div t-if="doc.physician_id" class="col-3 mb-2" name="physician_div">
                        <strong>Prescribing Doctor</strong>
                        <p class="m-0" t-field="doc.physician_id"/>
                    </div>
                    <div t-if="doc.date" class="col-3 mb-2">
                        <strong>Date</strong>
                        <p class="m-0" t-field="doc.date"/>
                    </div>
                </div>
                
                <p><strong>Patient Details</strong></p>
                <t t-if="not doc.is_group_request">
                    <div class="row mt8 mt8" id="patient_details">
                        <div class="col-6">
                            <ul>
                                <li id="patient_dob">Date Of Birth: <span t-field="doc.patient_id.birthday"/></li>
                            </ul>
                        </div>
                        <div class="col-6">
                            <ul>
                                <li id="patient_gov_id"><span t-field="doc.patient_id.gov_code_label"/>: <span t-field="doc.patient_id.gov_code"/></li>
                            </ul>
                        </div>
                    </div>
                </t>
                <t t-if="doc.is_group_request">
                    <table class="table table-condensed mt16" id="group_patient_details">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Date Of Birth</th>
                                <th><span t-field="doc.patient_id.gov_code_label"/></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>
                                    <span t-esc="doc.patient_id.name"/>
                                </td>
                                <td>
                                    <span t-esc="doc.patient_id.birthday"/>
                                </td>
                                <td>
                                    <span t-esc="doc.patient_id.gov_code"/>
                                </td>
                            </tr>
                            <t t-foreach="doc.group_patient_ids" t-as="patient">
                                <tr>
                                    <td>
                                        <span t-esc="patient.name"/>
                                    </td>
                                    <td>
                                        <span t-esc="patient.birthday"/>
                                    </td>
                                    <td>
                                        <span t-esc="patient.gov_code"/>
                                    </td>
                                </tr>
                            </t>
                        </tbody>
                    </table>
                </t>

                <t t-call="acs_radiology.report_radiology_prescription_table">
                    <t t-set="lines" t-value="doc.line_ids"/>
                </t>

                <p class="mt64" t-if="doc.notes">
                    <b>Comment:</b><br/>
                    <span t-esc="doc.notes"/>
                </p>
                <div class="mt16 row">
                    <div class="col-6" name="signature">
                        <b>Doctor’s Stamp/Signature</b>
                        <br/>
                        <t t-if="doc.physician_id and doc.physician_id.signature">
                            <span t-field="doc.physician_id.signature" t-options="{'widget': 'image', 'class': 'img-rounded', 'style':'max-height: 100px !important'}"/>
                        </t>
                    </div>
                    <div class="col-6" name="qrcode">
                    </div>
                </div>
            </div>
        </t>
    </template>

    <template id="report_acs_radiology_prescription">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="doc">
                <t t-call="acs_radiology.report_acs_radiology_prescription_document" t-lang="doc.patient_id.partner_id.lang"/>
            </t>
        </t>
    </template>

    <record id="action_report_acs_radiology_prescription" model="ir.actions.report">
        <field name="name">Radiology Prescription</field>
        <field name="model">acs.radiology.request</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">acs_radiology.report_acs_radiology_prescription</field>
        <field name="report_file">acs_radiology.report_acs_radiology_prescription</field>
        <field name="print_report_name">(object.name or 'RadiologyPrescription').replace('/','_') + '_RadiologyPrescription'</field>
        <field name="binding_model_id" ref="model_acs_radiology_request"/>
        <field name="binding_type">report</field>
    </record>

</odoo>
```

  File: report/radiology_report.xml
  Content:
```
<?xml version="1.0" encoding="UTF-8"?>
<odoo>

    <template id="report_acs_radiology_test_document_details">
        <h2 class="text-center">Investigation: <span t-field="doc.name"/></h2>
        <div class="row mt8 mb8" id="informations">
            <div t-if="doc.patient_id" class="col-auto col-3 mw-100 mb-2">
                <strong>Patient:</strong>
                <p class="m-0" t-field="doc.patient_id"/>
            </div>
            <div t-if="doc.radiology_request_id.patient_age" class="col-3 mb-2">
                <strong>Patient Age</strong>
                <p class="m-0" t-field="doc.radiology_request_id.patient_age"/>
            </div>
            <div t-if="doc.patient_id.gender" class="col-3 mb-2">
                <strong>Gender</strong>
                <p class="m-0" t-field="doc.patient_id.gender"/>
            </div>
            <div t-if="doc.date_analysis" class="col-auto col-3 mw-100 mb-2">
                <strong>Date:</strong>
                <p class="m-0" t-field="doc.date_analysis"/>
            </div>
        </div>
        <div class="row mt8 mb8" id="informations2">
            <div t-if="doc.test_id" class="col-auto col-3 mw-100 mb-2">
                <strong>Test Name:</strong>
                <p class="m-0" t-field="doc.test_id"/>
            </div>
            <div t-if="doc.user_id" class="col-auto col-3 mw-100 mb-2">
                <strong>Responsible:</strong>
                <p class="m-0" t-field="doc.user_id"/>
            </div>
        </div>

        <p class="mt32">
            <b>Diagnosis:</b><br/>
            <span t-field="doc.diagnosis"/>
        </p>
        
        <p class="mt32" t-if="doc.note">
            <b>Comment:</b><br/>
            <span t-field="doc.note"/>
        </p>
        <div class="mt16 row" name="sign_and_code">
            <div class="col-6" name="signature">
                <t t-if="doc.radiology_physician_id and doc.radiology_physician_id.signature">
                    <b>Doctor’s Stamp/Signature</b>
                    <br/>
                    <span t-field="doc.radiology_physician_id.signature" t-options="{'widget': 'image', 'class': 'img-rounded', 'style':'max-height: 100px !important'}"/>
                </t>
            </div>
            <div class="col-6" name="qrcode">
                <div class="text-end" t-if="doc.sudo().company_id.acs_radiology_result_qrcode">
                    <img t-if="doc.qr_image" t-att-src="image_data_uri(doc.qr_image)" alt="LAB Result QR" style="width: 100px;height: 100px" class="float-end"/>
                </div>
            </div>
        </div>
        <p t-if="doc.disclaimer" class="mt64">
            <b>Disclaimer: </b>
            <span t-field="doc.disclaimer"/>
        </p>
    </template>

    <template id="report_acs_radiology_test_document">
        <!-- Just for Portal Isuse -->
        <t t-set="doc" t-value="doc.sudo()"/>
        <t t-call="web.external_layout">
            <t t-set="doc" t-value="doc.with_context({'lang':doc.patient_id.lang})"/>
            <div class="page">
                <!-- Manage details in template so combined repotr can be printed in same page easily. -->
                <t t-call="acs_radiology.report_acs_radiology_test_document_details"/>
            </div>
        </t>
    </template>

    <template id="report_acs_radiology_test">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="doc">
                <t t-call="acs_radiology.report_acs_radiology_test_document" t-lang="doc.sudo().patient_id.partner_id.lang"/>
            </t>
        </t>
    </template>

    <record id="action_report_acs_radiology_test" model="ir.actions.report">
        <field name="name">Radiology Report</field>
        <field name="model">patient.radiology.test</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">acs_radiology.report_acs_radiology_test</field>
        <field name="report_file">acs_radiology.report_acs_radiology_test</field>
        <field name="print_report_name">(object.name or 'LabReport').replace('/','_') + '_LabReport'</field>
        <field name="binding_model_id" ref="model_patient_radiology_test"/>
        <field name="binding_type">report</field>
    </record>

</odoo>
```

  File: report/radiology_request_results.xml
  Content:
```
<?xml version="1.0" encoding="UTF-8"?>
<odoo>

    <template id="report_acs_radiology_result">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="req_doc">
                <t t-foreach="req_doc.patient_test_ids" t-as="doc">
                    <t t-call="acs_radiology.report_acs_radiology_test_document" t-lang="doc.sudo().patient_id.partner_id.lang"/>
                </t>
            </t>
        </t>
    </template>

    <record id="action_report_acs_radiology_results" model="ir.actions.report">
        <field name="name">Radiology Results</field>
        <field name="model">acs.radiology.request</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">acs_radiology.report_acs_radiology_result</field>
        <field name="report_file">acs_radiology.report_acs_radiology_result</field>
        <field name="print_report_name">(object._acs_get_report_base_filename())</field>
        <field name="binding_model_id" ref="model_acs_radiology_request"/>
        <field name="binding_type">report</field>
    </record>

</odoo>
```

